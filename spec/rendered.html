<!DOCTYPE html><html lang="en" dir="ltr"><head>
<meta charset="utf-8">
<meta name="generator" content="ReSpec 35.2.2">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>
span.example-title{text-transform:none}
:is(aside,div).example,div.illegal-example{padding:.5em;margin:1em 0;position:relative;clear:both}
div.illegal-example{color:red}
div.illegal-example p{color:#000}
aside.example div.example{border-left-width:.1em;border-color:#999;background:#fff}
</style>
<style>
.issue-label{text-transform:initial}
.warning>p:first-child{margin-top:0}
.warning{padding:.5em;border-left-width:.5em;border-left-style:solid}
span.warning{padding:.1em .5em .15em}
.issue.closed span.issue-number{text-decoration:line-through}
.issue.closed span.issue-number::after{content:" (Closed)";font-size:smaller}
.warning{border-color:#f11;border-color:var(--warning-border,#f11);border-width:.2em;border-style:solid;background:#fbe9e9;background:var(--warning-bg,#fbe9e9);color:#000;color:var(--text,#000)}
.warning-title:before{content:"⚠";font-size:1.3em;float:left;padding-right:.3em;margin-top:-.3em}
li.task-list-item{list-style:none}
input.task-list-item-checkbox{margin:0 .35em .25em -1.6em;vertical-align:middle}
.issue a.respec-gh-label{padding:5px;margin:0 2px 0 2px;font-size:10px;text-transform:none;text-decoration:none;font-weight:700;border-radius:4px;position:relative;bottom:2px;border:none;display:inline-block}
</style>
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;background:var(--indextable-hover-bg,#fff);color:#000;color:var(--text,#000);box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);box-shadow:0 1em 3em -.4em var(--tocsidebar-shadow,rgba(0,0,0,.3)),0 0 1px 1px var(--tocsidebar-shadow,rgba(0,0,0,.05));border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;border-bottom-color:var(--indextable-hover-bg,#fff);top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1;border-bottom-color:var(--indextable-hover-bg,#a2a9b1)}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;color:var(--text,#000);margin-top:.25em}
.dfn-panel ul a[href]{color:#333;color:var(--text,#333)}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
    
<title>RML Logical Views</title>
    
    
<link rel="stylesheet" type="text/css" href="./resources/css/extras.css">
    
    
<style type="text/css">

        /* Adapted from R2RML */
        aside.ex-input,
        aside.ex-mapping,
        aside.ex-output,
        aside.ex-intermediate {
            word-wrap:normal;
            margin-top: 1.5em;
            padding: 1em;
            font-size: 80%;
        }
        aside.ex-input:before,
        aside.ex-mapping:before,
        aside.ex-output:before,
        aside.ex-intermediate:before {
            background: white;
            display: block;
            font-family: sans-serif;
            font-size: 90%;
            margin: -1.5em 0 0.5em 0;
            padding: 0.4em 0.4em;
            width: 18em;
        }
        /* Input data example */
        aside.ex-input {
            background: #cee;
        }
        aside.ex-input,
        aside.ex-input:before {
            border: 1px solid #acc;
            overflow: auto;
        }
        aside.ex-input:before {
            content: "Example input data";
        }
        /* RML mapping example */
        aside.ex-mapping {
            background: #eeb;
        }
        aside.ex-mapping,
        aside.ex-mapping:before {
            border: 1px solid #cc9;
            overflow: auto;
        }
        aside.ex-mapping:before {
            content: "Example RML mapping";
        }
        /* Output RDF example */
        aside.ex-output {
            background: #cfc;
        }
        aside.ex-output,
        aside.ex-output:before {
            border: 1px solid #aca;
            overflow: auto;
        }
        aside.ex-output:before {
            content: "Example RDF output";
        }
        /* Intermediate representation example */
        aside.ex-intermediate {
            background: #ffc8d4;
        }
        aside.ex-intermediate,
        aside.ex-intermediate:before {
            border: 1px solid #aca;
            overflow: auto;
        }
        aside.ex-intermediate:before {
            content: "Example record sequence";
        }
        table, th, td {
          background: white;
          border-collapse: collapse;
          border: 1px solid;
        }
        th, td {
          padding: 5px;
          text-align: left;
        }
        th {
          font-weight: bold;
        }
    
</style>
    
    
    
<script data-goatcounter="https://rml-fields.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>
    
<noscript>
        &amp;lt;img src="https://rml-fields.goatcounter.com/count?p=/test-noscript"&amp;gt;
    </noscript>

<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline}
:is(h2,h3,h4,h5,h6):not(#toc>h2,#abstract>h2,#sotd>h2,.head>h2){position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-1.1em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>
<meta name="color-scheme" content="light">
<meta name="description" content="RML logical views is an extension of the RDF Mapping Language (RML) that increases the language's capability to
construct RDF datasets from nested input data, to join data sources (also across data hierarchies),
and to handle data sources that mix source formats,
by allowing to specify a logical view: a flattened, source format-agnostic view
over one or more existing data sources.
Additionally, it provides a mechanism to express relationships between data sources,
as well as additional information about their fields, through structural annotations.">
<style>
.hljs{--base:#fafafa;--mono-1:#383a42;--mono-2:#686b77;--mono-3:#717277;--hue-1:#0b76c5;--hue-2:#336ae3;--hue-3:#a626a4;--hue-4:#42803c;--hue-5:#ca4706;--hue-5-2:#c91243;--hue-6:#986801;--hue-6-2:#9a6a01}
@media (prefers-color-scheme:dark){
.hljs{--base:#282c34;--mono-1:#abb2bf;--mono-2:#818896;--mono-3:#5c6370;--hue-1:#56b6c2;--hue-2:#61aeee;--hue-3:#c678dd;--hue-4:#98c379;--hue-5:#e06c75;--hue-5-2:#be5046;--hue-6:#d19a66;--hue-6-2:#e6c07b}
}
.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;color:var(--mono-1,#383a42);background:#fafafa;background:var(--base,#fafafa)}
.hljs-comment,.hljs-quote{color:#717277;color:var(--mono-3,#717277);font-style:italic}
.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4;color:var(--hue-3,#a626a4)}
.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ca4706;color:var(--hue-5,#ca4706);font-weight:700}
.hljs-literal{color:#0b76c5;color:var(--hue-1,#0b76c5)}
.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#42803c;color:var(--hue-4,#42803c)}
.hljs-built_in,.hljs-class .hljs-title{color:#9a6a01;color:var(--hue-6-2,#9a6a01)}
.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801;color:var(--hue-6,#986801)}
.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#336ae3;color:var(--hue-2,#336ae3)}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:700}
.hljs-link{text-decoration:underline}
</style>
<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#222}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#222;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>
<script id="initialUserConfig" type="application/json">{
  "preProcess": [
    null
  ],
  "localBiblio": {
    "RML-Core": {
      "title": "RML-Core",
      "href": "https://w3id.org/rml/core/spec",
      "status": "Draft Community Group Report",
      "publisher": "W3C",
      "date": "16 February 2024",
      "id": "rml-core"
    },
    "RML-IO": {
      "title": "RML-IO",
      "href": "https://w3id.org/rml/io/spec",
      "status": "Draft Community Group Report",
      "publisher": "W3C",
      "date": "27 September 2023"
    }
  },
  "doRdfa": "true",
  "processVersion": 2024,
  "specStatus": "CG-DRAFT",
  "shortName": "rml-lv",
  "publishDate": "2025-01-14",
  "copyrightStart": "2024",
  "edDraftURI": "https://w3id.org/rml/lv/spec",
  "editors": [
    {
      "name": "Pano Maria",
      "mailto": "pano@skemu.com",
      "url": "mailto:pano@skemu.com",
      "company": "Skemu",
      "companyURL": "https://skemu.com"
    },
    {
      "name": "Els de Vleeschauwer",
      "mailto": "els.devleeschauwer@ugent.be",
      "company": "Ghent University &ndash; imec &ndash; IDLab",
      "orcidid": "0000-0002-8630-3947",
      "companyURL": "https://idlab.technology/",
      "url": "mailto:els.devleeschauwer@ugent.be"
    }
  ],
  "authors": [
    {
      "name": "Pano Maria",
      "mailto": "pano@skemu.com",
      "company": "Skemu",
      "companyURL": "https://skemu.com",
      "url": "mailto:pano@skemu.com"
    },
    {
      "name": "Els de Vleeschauwer",
      "mailto": "els.devleeschauwer@ugent.be",
      "company": "Ghent University &ndash; imec &ndash; IDLab",
      "orcidid": "0000-0002-8630-3947",
      "companyURL": "https://idlab.technology/",
      "url": "mailto:els.devleeschauwer@ugent.be"
    }
  ],
  "group": "kg-construct",
  "latestVersion": "https://w3id.org/rml/lv/spec/",
  "issueBase": "https://github.com/kg-construct/rml-lv/issues",
  "noRecTrack": "true",
  "otherLinks": [
    {
      "key": "This Version",
      "data": [
        {
          "value": "https://w3id.org/rml/lv/spec/%thisDate%/",
          "href": "https://w3id.org/rml/lv/spec/%thisDate%/"
        }
      ]
    },
    {
      "key": "Previous Version",
      "data": [
        {
          "value": "https://w3id.org/rml/lv/spec/%prevDate%/",
          "href": "https://w3id.org/rml/lv/spec/%prevDate%/"
        }
      ]
    },
    {
      "key": "Website",
      "data": [
        {
          "value": "https://github.com/kg-construct/rml-lv/",
          "href": "https://github.com/kg-construct/rml-lv/"
        }
      ]
    }
  ],
  "publishISODate": "2025-01-14T00:00:00.000Z",
  "generatedSubtitle": "Draft Community Group Report 14 January 2025"
}</script>
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/cg-draft"></head>
<body class="h-entry"><div class="head">
    
    <h1 id="title" class="title">RML Logical Views</h1> 
    <p id="w3c-state">
      <a href="https://www.w3.org/standards/types#reports">Draft Community Group Report</a>
      <time class="dt-published" datetime="2025-01-14">14 January 2025</time>
    </p>
    <dl>
      
      <dt>Latest published version:</dt><dd>
              <a href="https://w3id.org/rml/lv/spec/">https://w3id.org/rml/lv/spec/</a>
            </dd>
      <dt>Latest editor's draft:</dt><dd><a href="https://w3id.org/rml/lv/spec">https://w3id.org/rml/lv/spec</a></dd>
      
      
      
      
      <dt>Editors:</dt><dd class="editor p-author h-card vcard">
    <a class="ed_mailto u-email email p-name" href="mailto:pano@skemu.com">Pano Maria</a> (<a class="p-org org h-org" href="https://skemu.com">Skemu</a>)
  </dd><dd class="editor p-author h-card vcard">
    <a class="ed_mailto u-email email p-name" href="mailto:els.devleeschauwer@ugent.be">Els de Vleeschauwer</a> (<a class="p-org org h-org" href="https://idlab.technology/">Ghent University – imec – IDLab</a>)
  </dd>
      
      <dt>Authors:</dt><dd class="editor p-author h-card vcard">
    <a class="ed_mailto u-email email p-name" href="mailto:pano@skemu.com">Pano Maria</a> (<a class="p-org org h-org" href="https://skemu.com">Skemu</a>)
  </dd><dd class="editor p-author h-card vcard">
    <a class="ed_mailto u-email email p-name" href="mailto:els.devleeschauwer@ugent.be">Els de Vleeschauwer</a> (<a class="p-org org h-org" href="https://idlab.technology/">Ghent University – imec – IDLab</a>)
  </dd>
      
      <dt>This Version</dt><dd>
    <a href="https://w3id.org/rml/lv/spec/%thisDate%/">https://w3id.org/rml/lv/spec/%thisDate%/</a>
  </dd><dt>Previous Version</dt><dd>
    <a href="https://w3id.org/rml/lv/spec/%prevDate%/">https://w3id.org/rml/lv/spec/%prevDate%/</a>
  </dd><dt>Website</dt><dd>
    <a href="https://github.com/kg-construct/rml-lv/">https://github.com/kg-construct/rml-lv/</a>
  </dd>
    </dl>
    
    <p class="copyright">
          <a href="https://www.w3.org/policies/#copyright">Copyright</a>
          ©
          2024-2025
          
          the Contributors to the RML Logical Views
          Specification, published by the
          <a href="https://www.w3.org/groups/cg/kg-construct">Knowledge Graph Construction Community Group</a> under the
          <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>. A human-readable
                <a href="https://www.w3.org/community/about/agreements/cla-deed/">summary</a>
                is available.
              
        </p>
    <hr title="Separator for header">
  </div>
<section id="abstract" class="introductory"><h2 id="abstract">Abstract</h2><p>RML logical views is an extension of the RDF Mapping Language (RML) that increases the language's capability to
construct RDF datasets from nested input data, to join data sources (also across data hierarchies),
and to handle data sources that mix source formats,
by allowing to specify a logical view: a flattened, source format-agnostic view
over one or more existing data sources.
Additionally, it provides a mechanism to express relationships between data sources,
as well as additional information about their fields, through structural annotations.</p>
<p>This document describes RML logical views through definitions and examples. </p>
<p>The version of this document is <em>DRAFT</em>.</p>
</section>

<section id="sotd" class="introductory"><h2>Status of This Document</h2><p>
      This specification was published by the
      <a href="https://www.w3.org/groups/cg/kg-construct">Knowledge Graph Construction Community Group</a>. It is not a W3C Standard nor is it
      on the W3C Standards Track.
      
            Please note that under the
            <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>
            there is a limited opt-out and other conditions apply.
          
      Learn more about
      <a href="https://www.w3.org/community/">W3C Community and Business Groups</a>.
    </p>
    <p data-format="markdown"><p>This is an early draft,
yet efforts are made to keep things stable.</p>
</p>
</section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li><li class="tocline"><a class="tocxref" href="#overview"><bdi class="secno">1. </bdi>Overview</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#conventions"><bdi class="secno">1.1 </bdi>Document conventions</a></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">1.2 </bdi>Conformance</a></li></ol></li><li class="tocline"><a class="tocxref" href="#problem"><bdi class="secno">2. </bdi>Problem</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#nested-data-structures"><bdi class="secno">2.1 </bdi>Nested data structures</a></li><li class="tocline"><a class="tocxref" href="#mixed-data-formats"><bdi class="secno">2.2 </bdi>Mixed data formats</a></li><li class="tocline"><a class="tocxref" href="#joining-of-data-sources"><bdi class="secno">2.3 </bdi>Joining of data sources</a></li></ol></li><li class="tocline"><a class="tocxref" href="#records"><bdi class="secno">3. </bdi>Records</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#extending-the-logical-source"><bdi class="secno">3.1 </bdi>Extending the logical source</a></li><li class="tocline"><a class="tocxref" href="#record-sequences"><bdi class="secno">3.2 </bdi>Record sequences</a></li></ol></li><li class="tocline"><a class="tocxref" href="#logicalviews"><bdi class="secno">4. </bdi>Logical views</a></li><li class="tocline"><a class="tocxref" href="#fields"><bdi class="secno">5. </bdi>Fields</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#fieldparents"><bdi class="secno">5.1 </bdi>Field parents</a></li><li class="tocline"><a class="tocxref" href="#fieldnames"><bdi class="secno">5.2 </bdi>Field names</a></li><li class="tocline"><a class="tocxref" href="#fieldrecords"><bdi class="secno">5.3 </bdi>Field record sequences and records</a></li><li class="tocline"><a class="tocxref" href="#fieldreferenceformulations"><bdi class="secno">5.4 </bdi>Field reference formulations</a></li><li class="tocline"><a class="tocxref" href="#using-field-names-in-triples-maps"><bdi class="secno">5.5 </bdi>Using field names in triples maps</a></li></ol></li><li class="tocline"><a class="tocxref" href="#viewjoins"><bdi class="secno">6. </bdi>Logical view joins</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#dfn-join-type"><bdi class="secno">6.1 </bdi>Join types</a></li><li class="tocline"><a class="tocxref" href="#logical-view-join-examples"><bdi class="secno">6.2 </bdi>Logical view join examples</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#left-join"><bdi class="secno">6.2.1 </bdi>Left join</a></li><li class="tocline"><a class="tocxref" href="#inner-join"><bdi class="secno">6.2.2 </bdi>Inner join</a></li><li class="tocline"><a class="tocxref" href="#two-left-joins"><bdi class="secno">6.2.3 </bdi>Two left joins</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#annotations"><bdi class="secno">7. </bdi>Structural Annotations</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#invariance-principle"><bdi class="secno">7.1 </bdi>Invariance Principle</a></li><li class="tocline"><a class="tocxref" href="#irisafe"><bdi class="secno">7.2 </bdi>IriSafe</a></li><li class="tocline"><a class="tocxref" href="#primarykey"><bdi class="secno">7.3 </bdi>PrimaryKey</a></li><li class="tocline"><a class="tocxref" href="#unique"><bdi class="secno">7.4 </bdi>Unique</a></li><li class="tocline"><a class="tocxref" href="#notnull"><bdi class="secno">7.5 </bdi>NotNull</a></li><li class="tocline"><a class="tocxref" href="#foreignkey"><bdi class="secno">7.6 </bdi>ForeignKey</a></li><li class="tocline"><a class="tocxref" href="#inclusion"><bdi class="secno">7.7 </bdi>Inclusion</a></li></ol></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">A. </bdi>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">A.1 </bdi>Normative references</a></li></ol></li></ol></nav>

<section id="overview-0"><div class="header-wrapper"><h2 id="overview"><bdi class="secno">1. </bdi>Overview</h2><a class="self-link" href="#overview" aria-label="Permalink for Section 1."></a></div><p><em>This section is non-normative.</em></p>
<section id="document-conventions"><div class="header-wrapper"><h3 id="conventions"><bdi class="secno">1.1 </bdi>Document conventions</h3><a class="self-link" href="#conventions" aria-label="Permalink for Section 1.1"></a></div><p>We assume readers have basic familiarity with RDF and RML concepts.</p>
<p>In this document, examples assume 
the following namespace prefix bindings unless otherwise stated:</p>
<table>
<thead>
<tr>
<th>Prefix</th>
<th>Namespace</th>
</tr>
</thead>
<tbody><tr>
<td><code>rml:</code></td>
<td><a href="http://w3id.org/rml/">http://w3id.org/rml/</a></td>
</tr>
<tr>
<td><code>xsd:</code></td>
<td><a href="http://www.w3.org/2001/XMLSchema#">http://www.w3.org/2001/XMLSchema#</a></td>
</tr>
<tr>
<td><code>:</code></td>
<td><a href="http://example.org/">http://example.org/</a></td>
</tr>
</tbody></table>
<p>The examples are contained in color-coded boxes. We use the Turtle syntax [<cite><a class="bibref" data-link-type="biblio" href="#bib-turtle" title="RDF 1.1 Turtle">Turtle</a></cite>] to write RDF.</p>
<aside class="ex-input">
# This box contains an example input
</aside>

<aside class="ex-mapping">
# This box contains an example mapping
</aside>

<aside class="ex-intermediate">
# This box contains the example intermediate representation
</aside>

<aside class="ex-output">
# This box contains the example output
</aside></section><section id="conformance"><div class="header-wrapper"><h3 id="x1-2-conformance"><bdi class="secno">1.2 </bdi>Conformance</h3><a class="self-link" href="#conformance" aria-label="Permalink for Section 1.2"></a></div><p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p><p>
        The key words <em class="rfc2119">MAY</em>, <em class="rfc2119">MUST</em>, and <em class="rfc2119">SHOULD</em> in this document
        are to be interpreted as described in
        <a href="https://datatracker.ietf.org/doc/html/bcp14">BCP 14</a>
        [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
        when, and only when, they appear in all capitals, as shown here.
      </p> </section>

</section>

<section id="problem-0"><div class="header-wrapper"><h2 id="problem"><bdi class="secno">2. </bdi>Problem</h2><a class="self-link" href="#problem" aria-label="Permalink for Section 2."></a></div><p><em>This section is non-normative.</em></p>
<p>RML Logical Views aims to resolve challenges such as handling hierarchy of nested data, more flexible joining (also across data hierarchies), and handling data sources that mix source formats.</p>
<section id="nested-data-structures"><div class="header-wrapper"><h3 id="x2-1-nested-data-structures"><bdi class="secno">2.1 </bdi>Nested data structures</h3><a class="self-link" href="#nested-data-structures" aria-label="Permalink for Section 2.1"></a></div>
<p>References to nested data structures, like JSON or XML, may return multiple values. These values can be composite: they may again contain multiple values. 
<cite><a class="respec-offending-element" title="No matching definition found." id="respec-offender-no-matching-definition-found" href="https://w3id.org/rml/core/spec">RML-Core</a></cite> defines mapping constructs that produce results by combining the results of other mapping constructs in a specific order. 
For example, a <a href="https://w3id.org/rml/core/spec#dfn-triples-map">triples map</a> combines the results of a <a href="https://w3id.org/rml/core/spec#dfn-subject-map">subject map</a> and a <a href="https://w3id.org/rml/core/spec#dfn-predicate-object-map">predicate-object map</a> in that order. 
Another example is a <a href="https://w3id.org/rml/core/spec#dfn-template-expression">template expression</a>, 
which combines character strings and zero or more <a href="https://w3id.org/rml/core/spec#dfn-reference-expression">reference expressions</a> in declared order. 
When mapping constructs produce multiple results, the combining mapping constructs will apply an <a href="https://w3id.org/rml/core/spec#dfn-n-ary-cartesian-product">n-ary Cartesian product</a> over the sets of results, maintaining the order of the mapping constructs. In the case of nested data structures, this may cause the generation of results that do not match the source hierarchy, i.e. do not follow the root-to-leaf paths in the source data, since values are combined irrespective of it.</p>
<p>Furthermore, there is varying expressiveness in data source expression and query languages, and many languages have limited support for hierarchy traversal. For example, JSONPath has no operator to refer to an ancestor in the document hierarchy.</p>
<p>This limits the ability of <a href="https://kg-construct.github.io/rml-core/spec/docs/">RML-Core</a> to map nested data.</p>
<aside class="example" id="ex-nesting-problem"><div class="marker">
    <a class="self-link" href="#ex-nesting-problem">Example<bdi> 1</bdi></a>
  </div>
It is not possible to declare the construction of below output triples from below data source with RML-Core. 
<aside class="ex-input">

<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"people"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"alice"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sword"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1500</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"shield"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2500</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bob"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"flower"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</aside>

<aside class="ex-output">

<pre><code class="turtle hljs" aria-busy="false">:person/alice/item/sword :hasName "sword" ;
  :hasWeight 1500 .
:person/alice/item/shield :hasName "shield" ;
  :hasWeight 2500 .
:person/bob/item/flower :hasName "flower" ;
  :hasWeight 15 .
</code></pre>
</aside>
</aside>


</section><section id="mixed-data-formats"><div class="header-wrapper"><h3 id="x2-2-mixed-data-formats"><bdi class="secno">2.2 </bdi>Mixed data formats</h3><a class="self-link" href="#mixed-data-formats" aria-label="Permalink for Section 2.2"></a></div>
<p>Data in one format can contain multiple or composite values stored in another format, e.g. a CSV dataset could contain columns containing JSON values. To define the expected form of references to input data <a href="https://kg-construct.github.io/rml-core/spec/docs/">RML-Core</a> employs the notion of a <a href="https://kg-construct.github.io/rml-io/spec/docs/#reference-formulations">reference formulation</a> that is a property of every <a href="https://kg-construct.github.io/rml-io/spec/docs/#defining-logical-sources">logical source</a>. However, currently a logical source is limited to having a single reference formulation, meaning mixed format data can only be referenced using a query language that supports just one of the formats.</p>
<aside class="example" id="ex-mixed-format-problem"><div class="marker">
    <a class="self-link" href="#ex-mixed-format-problem">Example<bdi> 2</bdi></a>
  </div>
It is not possible to declare the construction of below output triples from below data source with RML-Core. 
<aside class="ex-input">

<pre><code class="csv hljs" aria-busy="false">name,item  
alice,"{""type"":""sword"",""weight"": 2500}" 
alice,"{""type"":""shield"",""weight"": 1500}"  
bob,"{""type"":""flower"",""weight"": 15 }"  
</code></pre>
</aside>

<aside class="ex-output">

<pre><code class="turtle hljs" aria-busy="false">:person/alice :hasItem "sword" , "shield" .
:person/bob :hasItem "flower" . 
</code></pre>
</aside>
</aside>

</section><section id="joining-of-data-sources"><div class="header-wrapper"><h3 id="x2-3-joining-of-data-sources"><bdi class="secno">2.3 </bdi>Joining of data sources</h3><a class="self-link" href="#joining-of-data-sources" aria-label="Permalink for Section 2.3"></a></div>
<p><a href="https://kg-construct.github.io/rml-core/spec/docs/">RML-Core</a> restricts join operations to <a href="https://w3id.org/rml/core/spec#referencing-object-map">referencing object maps</a>. Since a referencing object map can only generate an object that is an IRI or blank node subject as specified by a parent triples map, it is not possible to combine data from two sources in one term, use data from a join on another position than the object, or generate a literal using data from a join.
Moreover, <a href="https://kg-construct.github.io/rml-core/spec/docs/">RML-Core</a> cannot declare join operations correctly across hierarchies.</p>
<aside class="example" id="ex-mixed-format-problem"><div class="marker">
    <a class="self-link" href="#ex-mixed-format-problem">Example<bdi> 3</bdi></a>
  </div>
It is not possible to declare the construction of below output triples from below two data sources with RML-Core. 
<aside class="ex-input">

<pre><code class="csv hljs" aria-busy="false">name,id
alice,123
bob,456
tobias,789
</code></pre>
</aside>

<aside class="ex-input">

<pre><code class="csv hljs" aria-busy="false">name,item_type
alice,sword
alice,shield
bob,flower
</code></pre>
</aside>

<aside class="ex-output">

<pre><code class="turtle hljs" aria-busy="false">:person/123 :hasItem "sword", "shield" . 
:person/456 :hasItem "flower" .
</code></pre>
</aside>
</aside></section></section>

<section id="records-0"><div class="header-wrapper"><h2 id="records"><bdi class="secno">3. </bdi>Records</h2><a class="self-link" href="#records" aria-label="Permalink for Section 3."></a></div><p>A <dfn data-plurals="records" id="dfn-record" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">record</dfn> is created using an <a href="http://w3id.org/rml/core/spec#dfn-iterator">iterator</a> or an <a href="https://w3id.org/rml/core/spec#dfn-expressions">expression</a>. Depending on the source type, <a data-link-type="dfn|abstract-op" href="#dfn-record" class="internalDFN" id="ref-for-dfn-record-1">records</a> might take different forms: for tabular data sources, a <a data-link-type="dfn|abstract-op" href="#dfn-record" class="internalDFN" id="ref-for-dfn-record-2">record</a> might be a row or a cell; for tree-structured sources like XML, a <a data-link-type="dfn|abstract-op" href="#dfn-record" class="internalDFN" id="ref-for-dfn-record-3">record</a> might be a node; for document-structured sources like JSON, a <a data-link-type="dfn|abstract-op" href="#dfn-record" class="internalDFN" id="ref-for-dfn-record-4">record</a> might be a document or property value.</p>
<p>A <a data-link-type="dfn|abstract-op" href="#dfn-record" class="internalDFN" id="ref-for-dfn-record-5">record</a> <em class="rfc2119">MUST</em> have a string representation. It <em class="rfc2119">MAY</em> be possible to derive other <a data-link-type="dfn|abstract-op" href="#dfn-record" class="internalDFN" id="ref-for-dfn-record-6">records</a> from a <a data-link-type="dfn|abstract-op" href="#dfn-record" class="internalDFN" id="ref-for-dfn-record-7">record</a> using an <a href="https://w3id.org/rml/core/spec#dfn-expressions">expression</a>.</p>
<aside class="example" id="csviterator"><div class="marker">
    <a class="self-link" href="#csviterator">Example<bdi> 4</bdi></a>
  </div>

<aside class="ex-input">

<pre><code class="csv hljs" aria-busy="false">name,birthyear
alice,1995
bob,1999
tobias,2005
</code></pre>
</aside>

<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:csvSource</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalSource</span> ;
  <span class="hljs-symbol">rml:source</span> <span class="hljs-symbol">:csvFile</span> ;
  <span class="hljs-symbol">rml:referenceFormulation</span> <span class="hljs-symbol">rml:CSV</span> .
</code></pre>
</aside>

<p>The default iterator for CSV files is row-based iteration, skipping the header row. Therefore, in this example, the iterator of the logical source <code>:csvSource</code> defines three <a data-link-type="dfn|abstract-op" href="#dfn-record" class="internalDFN" id="ref-for-dfn-record-8">records</a>:</p>
<pre><code class="csv hljs" aria-busy="false">alice,1995
</code></pre>
<p>and</p>
<pre><code class="csv hljs" aria-busy="false">bob,1999
</code></pre>
<p>and</p>
<pre><code class="csv hljs" aria-busy="false">tobias,2005
</code></pre>
<p>.</p>
</aside>

<aside class="example" id="xpathiterator"><div class="marker">
    <a class="self-link" href="#xpathiterator">Example<bdi> 5</bdi></a>
  </div>

<aside class="ex-input">

<pre><code class="xml hljs" aria-busy="false"><span class="hljs-tag">&lt;<span class="hljs-name">People</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Person</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cindy"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Friends</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Person</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dave"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Person</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"edmund"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Friends</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Person</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Person</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"fred"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Friends</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Friends</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Person</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">People</span>&gt;</span>
</code></pre>
</aside>

<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:xmlSource</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalSource</span> ;
  <span class="hljs-symbol">rml:source</span> <span class="hljs-symbol">:xmlFile</span> ;
  <span class="hljs-symbol">rml:referenceFormulation</span> <span class="hljs-symbol">rml:XPath</span> ;
  <span class="hljs-symbol">rml:iterator</span> <span class="hljs-string">"/People/Person"</span> .
</code></pre>
</aside>

<p>In this example, the XPath expression <code>/People/Person</code> is used as &lt;a data-cite="RML-Core#dfn-iterator&gt;logical iterator. The sequence of <a data-link-type="dfn|abstract-op" href="#dfn-record" class="internalDFN" id="ref-for-dfn-record-9">records</a> it defines are the <code>Person</code> nodes on the first level in the document that have string representations</p>
<pre><code class="xml hljs" aria-busy="false"><span class="hljs-tag">&lt;<span class="hljs-name">Person</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cindy"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Friends</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Person</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dave"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Person</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"edmund"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Friends</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Person</span>&gt;</span>
</code></pre>
<p>and</p>
<pre><code class="xml hljs" aria-busy="false"><span class="hljs-tag">&lt;<span class="hljs-name">Person</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"fred"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Friends</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Friends</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Person</span>&gt;</span>
</code></pre>
<p>.</p>
</aside>

<aside class="example" id="jsonpathiterator"><div class="marker">
    <a class="self-link" href="#jsonpathiterator">Example<bdi> 6</bdi></a>
  </div>

<aside class="ex-input">

<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"people"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"alice"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sword"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1500</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"shield"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2500</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bob"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"flower"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</aside>

<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:jsonSource</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalSource</span> ;
  <span class="hljs-symbol">rml:source</span> <span class="hljs-symbol">:jsonFile</span> ;
  <span class="hljs-symbol">rml:referenceFormulation</span> <span class="hljs-symbol">rml:JSONPath</span> ;
  <span class="hljs-symbol">rml:iterator</span> <span class="hljs-string">"$.people[*]"</span> .
</code></pre>
</aside>

<p>In this example, the JSONPath expression <code>$.people[*]</code> is used as <a href="http://w3id.org/rml/core/spec#dfn-iterator">iterator</a>. The sequence of <a data-link-type="dfn|abstract-op" href="#dfn-record" class="internalDFN" id="ref-for-dfn-record-10">records</a> it defines are the elements of the <code>people</code> array in the document that have string representations.</p>
<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"alice"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sword"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1500</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"shield"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2500</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>and</p>
<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bob"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"flower"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>.</p>
</aside>

<p>For a given <a data-link-type="dfn|abstract-op" href="#dfn-record" class="internalDFN" id="ref-for-dfn-record-11">record</a>, the evaluation of an <a href="https://w3id.org/rml/core/spec#dfn-expressions">expression</a> against it <em class="rfc2119">MUST</em> either result in an ordered sequence of <a data-link-type="dfn|abstract-op" href="#dfn-record" class="internalDFN" id="ref-for-dfn-record-12">records</a>, called the <dfn id="dfn-expression-values" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn" class="respec-offending-element" title="Found definition for &quot;expression values&quot;, but nothing links to it. This is usually a spec bug!">expression values</dfn>, or throw an error. An <a href="https://w3id.org/rml/core/spec#dfn-expressions">expression</a> <em class="rfc2119">MUST</em> be valid for the given <a href="http://w3id.org/rml/core/spec#dfn-reference-formulation">reference formulation</a>.</p>
<div class="note" role="note" id="issue-container-generatedID"><div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>Note</span></div><aside class="">

<p>This definition of expression <em>is</em> different from <a href="https://w3id.org/rml/core/spec#dfn-expressions">the definition</a> given in the RML Core specification on two points. Firstly, the RML Core specification defines the result of an expression evaluation as being a set of values, while here an ordered sequence of values is defined. Secondly, we consider expression values that might themselves be <a data-link-type="dfn|abstract-op" href="#dfn-record" class="internalDFN" id="ref-for-dfn-record-13">records</a>.</p>
</aside></div>

<aside class="example" id="csvreference"><div class="marker">
    <a class="self-link" href="#csvreference">Example<bdi> 7</bdi></a>
  </div>

<p>Continuing <a href="#csviterator" data-matched-text="[[[#csviterator]]]" class="box-ref">Example<bdi> 4</bdi></a>, the reference <code>name</code> would define the length-one sequence <code>alice</code> from the record <code>alice,1995</code>, the length-one sequence <code>bob</code> from the record <code>bob,1999</code> and the length-one sequence <code>tobias</code> from the record <code>tobias,2005</code>.</p>
<p>The reference <code>nonsense</code> would give an error, since it is not in the header of the CSV file. Note the reference <code>nonsense</code> is not malformed. The reference <code>bad,ref</code> would <em>also</em> throw an error, as it is malformed: it contains the unescaped <code>,</code> separator.</p>
</aside>

<aside class="example" id="xpathreference"><div class="marker">
    <a class="self-link" href="#xpathreference">Example<bdi> 8</bdi></a>
  </div>

<p>Continuing <a href="#xpathiterator" data-matched-text="[[[#xpathiterator]]]" class="box-ref">Example<bdi> 5</bdi></a>, the reference <code>Friends/Person/@name</code> would define the length-two sequence <code>dave</code>, <code>edmund</code> from the record <code>&lt;Person name="cindy"&gt;&lt;Friends&gt;&lt;Person name="dave"/&gt;&lt;Person name="edmund"/&gt;&lt;/Friends&gt;&lt;/Person&gt;</code> and the empty sequence from the record <code>&lt;Person name="fred"&gt;&lt;Friends&gt;&lt;/Friends&gt;&lt;/Person&gt;</code>.</p>
<p>The reference <code>Siblings/Person/@name</code> would also define empty sequences of record. The reference <code>[unbalanced</code> would give an error, since it is not a valid relative XPath expression.</p>
</aside>

<aside class="example" id="jsonpathreference"><div class="marker">
    <a class="self-link" href="#jsonpathreference">Example<bdi> 9</bdi></a>
  </div>

<p>Continuing <a href="#jsonpathiterator" data-matched-text="[[[#jsonpathiterator]]]" class="box-ref">Example<bdi> 6</bdi></a>, the reference <code>$.items[*]</code> would define the length-two sequence <code>{"type": "sword", "weight": 1500}</code>, <code>{"type": "shield", "weight": 2500}</code> from the record <code>{ "name": "alice", "items": [{"type": "sword", "weight": 1500}, {"type": "shield", "weight": 2500}]}</code> and the length-one sequence <code>{"type": "flower", "weight": 15}</code> from the record <code>{ "name": "bob", "items": [{"type": "flower", "weight": 15}]}</code>.</p>
<p>The references <code>$.type</code> can be used to refer to data inside the records in the sequences defined by <code>$.items[*]</code>. Doing so would define the three length-one sequences <code>"sword"</code>, <code>"shield"</code> and <code>"flower"</code>.</p>
<p>The reference <code>$.nonsense</code> would define empty sequences of record since the <code>nonsense</code> attribute does not occur in the data. The reference <code>[unbalanced</code> would give an error, since it is not a valid relative JSONPath expression.</p>
</aside>


<section id="extending-the-logical-source"><div class="header-wrapper"><h3 id="x3-1-extending-the-logical-source"><bdi class="secno">3.1 </bdi>Extending the logical source</h3><a class="self-link" href="#extending-the-logical-source" aria-label="Permalink for Section 3.1"></a></div>
<p>A <a href="https://w3id.org/rml/core/spec#dfn-logical-iteration">logical iteration</a> <em class="rfc2119">MUST</em> have a string representation.</p>
<div class="issue" id="issue-container-number-1"><div role="heading" class="issue-title marker" id="h-issue" aria-level="4"><span>Issue 1</span></div><aside class="">
Describe how logical iteration relates to records.
</aside></div>

</section><section id="record-sequences"><div class="header-wrapper"><h3 id="x3-2-record-sequences"><bdi class="secno">3.2 </bdi>Record sequences</h3><a class="self-link" href="#record-sequences" aria-label="Permalink for Section 3.2"></a></div>
<p>A <dfn id="dfn-record-sequence" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">record sequence</dfn> is an ordered sequence of sets of key-value pairs, where each key is a string and each value a <a data-link-type="dfn|abstract-op" href="#dfn-record" class="internalDFN" id="ref-for-dfn-record-14">record</a>. A record sequence <em class="rfc2119">MUST</em> have a finite set of keys that appear in each set in the sequence. In any particular set in a record sequence, the value of a key <em class="rfc2119">MAY</em> be a null value.</p>
<p>An <a href="">iterator</a> defines a <a data-link-type="dfn|abstract-op" href="#dfn-record-sequence" class="internalDFN" id="ref-for-dfn-record-sequence-1">record sequence</a> from the iterator's [logical source], called the <dfn id="dfn-iterator-record-sequence" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn" class="respec-offending-element" title="Found definition for &quot;iterator record sequence&quot;, but nothing links to it. This is usually a spec bug!">iterator record sequence</dfn>. This record sequence has two keys:</p>
<ul>
<li>An index key <code>#</code> with as corresponding values the position of the current entry in the sequence defined by the iterator.</li>
<li>A key <code>&lt;it&gt;</code> with as corresponding values the records in the sequence defined by the iterator.</li>
</ul>
<aside class="example" id="ex-record-sequence"><div class="marker">
    <a class="self-link" href="#ex-record-sequence">Example<bdi> 10</bdi></a>
  </div>

<aside class="ex-input">

<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"people"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"alice"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sword"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1500</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"shield"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2500</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bob"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"flower"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</aside>

<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:jsonSource</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalSource</span> ;
  <span class="hljs-symbol">rml:source</span> <span class="hljs-symbol">:jsonFile</span> ;
  <span class="hljs-symbol">rml:referenceFormulation</span> <span class="hljs-symbol">rml:JSONPath</span> ;
  <span class="hljs-symbol">rml:iterator</span> <span class="hljs-string">"$.people[*]"</span> .
</code></pre>
</aside>

<aside class="ex-intermediate">
<table>
<tbody><tr><th>

<p><code>#</code></p>
</th>
<th>

<p><code>&lt;it&gt;</code></p>
</th>
</tr><tr>
<td>
0
</td>
<td>

<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"alice"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sword"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1500</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"shield"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2500</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</td>
</tr>
<tr>
<td>
1
</td>
<td>

<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bob"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"flower"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</td>
</tr>
</tbody></table>
</aside>

</aside></section></section>

<section id="logical-views"><div class="header-wrapper"><h2 id="logicalviews"><bdi class="secno">4. </bdi>Logical views</h2><a class="self-link" href="#logicalviews" aria-label="Permalink for Section 4."></a></div><p>A <dfn id="dfn-logical-view" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">logical view</dfn> is a type of <a href="https://w3id.org/rml/core/spec##dfn-abstract-logical-source">abstract logical source</a> that is derived from another <a href="https://w3id.org/rml/core/spec##dfn-abstract-logical-source">abstract logical source</a> by defining <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-1">fields</a> with data from said <a href="https://w3id.org/rml/core/spec##dfn-abstract-logical-source">abstract logical source</a>.</p>
<p>A <a data-link-type="dfn|abstract-op" href="#dfn-logical-view" class="internalDFN" id="ref-for-dfn-logical-view-1">logical view</a> (<code>rml:LogicalView</code>) is represented by a resource that <em class="rfc2119">MUST</em> contain:</p>
<ul>
<li>exactly one view on property (<code>rml:viewOn</code>), whose value is a <a href="https://w3id.org/rml/core/spec##dfn-abstract-logical-source">abstract logical source</a> (<code>rml:AbstractLogicalSource</code>),</li>
<li>at least one field property (<code>rml:field</code>), whose value is a <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-2">field</a> (<code>rml:Field</code>).</li>
<li>zero or more join properties (<code>rml:leftJoin</code>, <code>rml:innerJoin</code>), whose value is a <a data-link-type="dfn|abstract-op" href="#dfn-logical-view-join" class="internalDFN" id="ref-for-dfn-logical-view-join-1">logical view join</a> (<code>rml:LogicalViewJoin</code>).</li>
</ul>
<p>A <a data-link-type="dfn|abstract-op" href="#dfn-logical-view" class="internalDFN" id="ref-for-dfn-logical-view-2">logical view</a> (<code>rml:LogicalView</code>) has an implicit default <a href="https://w3id.org/rml/core/spec##dfn-reference-formulation">reference formulation</a> (<code>rml:referenceFormulation</code>) and <a href="https://w3id.org/rml/core/spec##dfn-iterator">logical iterator</a>  (<code>rml:iterator</code>), which <em class="rfc2119">MUST</em> not be overwritten. </p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Domain</th>
<th>Range</th>
</tr>
</thead>
<tbody><tr>
<td><code>rml:viewOn</code></td>
<td><code>rml:LogicalView</code></td>
<td><code>rml:LogicalSource</code></td>
</tr>
<tr>
<td><code>rml:field</code></td>
<td><code>rml:LogicalView</code> or <code>rml:Field</code></td>
<td><code>rml:Field</code></td>
</tr>
<tr>
<td><code>rml:leftJoin</code></td>
<td><code>rml:LogicalView</code></td>
<td><code>rml:LogicalViewJoin</code></td>
</tr>
<tr>
<td><code>rml:innerJoin</code></td>
<td><code>rml:LogicalView</code></td>
<td><code>rml:LogicalViewJoin</code></td>
</tr>
</tbody></table>
</section>

<section id="fields-0"><div class="header-wrapper"><h2 id="fields"><bdi class="secno">5. </bdi>Fields</h2><a class="self-link" href="#fields" aria-label="Permalink for Section 5."></a></div><p>A <dfn data-plurals="fields" id="dfn-field" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">field</dfn> gives a name to data derived from the <a href="https://w3id.org/rml/core/spec#dfn-abstract-logical-source">abstract logical source</a> on which the <a data-link-type="dfn|abstract-op" href="#dfn-logical-view" class="internalDFN" id="ref-for-dfn-logical-view-3">logical view</a> is defined. </p>
<p>A <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-3">field</a> (<code>rml:Field</code>) is represented by a resource that <em class="rfc2119">MUST</em> contain:</p>
<ul>
<li>exactly one field name property (<code>rml:fieldName</code>), that specifies the <a data-link-type="dfn|abstract-op" href="#dfn-field-name" class="internalDFN" id="ref-for-dfn-field-name-1">name</a> of the field</li>
<li>zero or more field properties (<code>rml:field</code>), to describe nested <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-4">field</a>, also of the type <code>rml:Field</code></li>
</ul>
<table>
<thead>
<tr>
<th>Property</th>
<th>Domain</th>
<th>Range</th>
</tr>
</thead>
<tbody><tr>
<td><code>rml:fieldName</code></td>
<td><code>rml:Field</code></td>
<td><code>xsd:string</code></td>
</tr>
<tr>
<td><code>rml:field</code></td>
<td><code>rml:LogicalView</code> or <code>rml:Field</code></td>
<td><code>rml:Field</code></td>
</tr>
</tbody></table>
<p>There are two types of fields: an <a data-link-type="dfn|abstract-op" href="#dfn-expression-field" class="internalDFN" id="ref-for-dfn-expression-field-1">expression field</a> and an <a data-link-type="dfn|abstract-op" href="#dfn-iterable-field" class="internalDFN" id="ref-for-dfn-iterable-field-1">iterable field</a>.</p>
<p>An <dfn id="dfn-expression-field" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">expression field</dfn> (<code>rml:ExpressionField</code>) is a type of <a href="https://w3id.org/rml/core/spec#dfn-expression-map">expression map</a>.
Consequently, an <a data-link-type="dfn|abstract-op" href="#dfn-expression-field" class="internalDFN" id="ref-for-dfn-expression-field-2">expression field</a> <em class="rfc2119">MUST</em> have an <a href="https://w3id.org/rml/core/spec#dfn-expressions">expression</a>. </p>
<p>An <dfn id="dfn-iterable-field" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">iterable field</dfn> (<code>rml:IterableField</code>) is a type of <a href="https://w3id.org/rml/core/spec#dfn-iterable">iterable</a>. 
Consequently, an <a data-link-type="dfn|abstract-op" href="#dfn-iterable-field" class="internalDFN" id="ref-for-dfn-iterable-field-2">iterable field</a> <em class="rfc2119">MUST</em> have a <a href="https://w3id.org/rml/core/spec##dfn-reference-formulation">reference formulation</a> and a <a href="https://w3id.org/rml/core/spec#dfn-iterator">logical iterator</a>.
If no reference formulation is declared for a field, the reference formulation of the field's <a data-link-type="dfn|abstract-op" href="#dfn-parent" class="internalDFN" id="ref-for-dfn-parent-1">parent</a> is implied. </p>
<section id="field-parents"><div class="header-wrapper"><h3 id="fieldparents"><bdi class="secno">5.1 </bdi>Field parents</h3><a class="self-link" href="#fieldparents" aria-label="Permalink for Section 5.1"></a></div><p>A <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-5">field</a> <em class="rfc2119">MUST</em> have a <dfn id="dfn-parent" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">parent</dfn> that is either <a href="https://w3id.org/rml/core/spec##dfn-abstract-logical-source">abstract logical source</a> or another <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-6">field</a>. The parent relation <em class="rfc2119">MUST</em> not contain cycles: it is tree-shaped with a <a data-link-type="dfn|abstract-op" href="#dfn-logical-view" class="internalDFN" id="ref-for-dfn-logical-view-4">logical view</a> as its root. The transitive parents of a <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-7">field</a>, i.e., the <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-8">field</a>'s parent, the parent of the <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-9">field</a>'s parent, etcetera, are fittingly called the <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-10">field</a>'s <dfn id="dfn-ancestors" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn" class="respec-offending-element" title="Found definition for &quot;ancestors&quot;, but nothing links to it. This is usually a spec bug!">ancestors</dfn>. </p>
</section><section id="field-names"><div class="header-wrapper"><h3 id="fieldnames"><bdi class="secno">5.2 </bdi>Field names</h3><a class="self-link" href="#fieldnames" aria-label="Permalink for Section 5.2"></a></div><p>A <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-11">field</a> <em class="rfc2119">MUST</em> have a <dfn id="dfn-declared-name" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">declared name</dfn> that is an alphanumerical string. Fields with the same <a data-link-type="dfn|abstract-op" href="#dfn-parent" class="internalDFN" id="ref-for-dfn-parent-2">parent</a> <em class="rfc2119">MUST</em> have different declared names. If a <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-12">field</a>'s parent is another <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-13">field</a>, we distinguish between the <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-14">field</a>'s declared name and the <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-15">field</a>'s name. A <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-16">field</a>'s <dfn data-lt="field name|name" id="dfn-field-name" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">name</dfn> is the concatenation of the name of the parent <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-17">field</a>, a dot <code>.</code>, and the <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-18">field</a>'s declared name. </p>
<aside class="example" id="ex-field"><div class="marker">
    <a class="self-link" href="#ex-field">Example<bdi> 11</bdi></a>
  </div>

<p>In this example a <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-19">field</a> with <a data-link-type="dfn|abstract-op" href="#dfn-declared-name" class="internalDFN" id="ref-for-dfn-declared-name-1">declared name</a> "name" is declared on the <a href="https://w3id.org/rml/core/spec##dfn-logical-source">logical source</a> from <a href="#ex-record-sequence" data-matched-text="[[[#ex-record-sequence]]]" class="box-ref">Example<bdi> 10</bdi></a> and added to the <a data-link-type="dfn|abstract-op" href="#dfn-logical-view" class="internalDFN" id="ref-for-dfn-logical-view-5">logical view</a>. The parent of the field with <a data-link-type="dfn|abstract-op" href="#dfn-declared-name" class="internalDFN" id="ref-for-dfn-declared-name-2">declared name</a> "name" is the <a href="https://w3id.org/rml/core/spec##dfn-logical-source">logical source</a> <code>:jsonSource</code>.</p>
<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:jsonView</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalView</span> ;
  <span class="hljs-symbol">rml:viewOn</span> <span class="hljs-symbol">:jsonSource</span> ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"name"</span> ;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"$.name"</span> ;
  ] .
</code></pre>
</aside>

<aside class="ex-intermediate">
<table>
<tbody><tr><th>#</th>
<th>

<p><code>&lt;it&gt;</code></p>
</th>
<th>name.#</th>
<th>name</th>
</tr><tr>
<td>0</td>
<td>

<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"alice"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sword"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1500</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"shield"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2500</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</td>
<td>0</td>
<td>alice</td>
</tr>
<tr>
<td>1</td>
<td>

<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bob"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"flower"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</td>
<td>0</td>
<td>bob</td>
</tr>
</tbody></table>
</aside>

</aside>

<div class="note" role="note" id="issue-container-generatedID-0"><div role="heading" class="note-title marker" id="h-note-0" aria-level="4"><span>Note</span></div><aside class="">
Note that the tabular representation of the <a data-link-type="dfn|abstract-op" href="#dfn-field-record-sequence" class="internalDFN" id="ref-for-dfn-field-record-sequence-1">field record sequence</a> in <a href="#ex-field" data-matched-text="[[[#ex-field]]]" class="box-ref">Example<bdi> 11</bdi></a> is just one possible way of representing fields.
</aside></div>

</section><section id="field-record-sequences-and-records"><div class="header-wrapper"><h3 id="fieldrecords"><bdi class="secno">5.3 </bdi>Field record sequences and records</h3><a class="self-link" href="#fieldrecords" aria-label="Permalink for Section 5.3"></a></div><p>A <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-20">field</a> defines a <a data-link-type="dfn|abstract-op" href="#dfn-record-sequence" class="internalDFN" id="ref-for-dfn-record-sequence-2">record sequence</a>, called the <dfn id="dfn-field-record-sequence" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">field record sequence</dfn>, that is obtained by consecutively applying the <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-21">field</a>'s <a href="https://w3id.org/rml/core/spec#dfn-expressions">expression</a> (in case of an <a data-link-type="dfn|abstract-op" href="#dfn-expression-field" class="internalDFN" id="ref-for-dfn-expression-field-3">expression field</a>) or the <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-22">field</a>'s <a href="https://w3id.org/rml/core/spec##dfn-reference-formulation">reference formulation</a> and a <a href="https://w3id.org/rml/core/spec#dfn-iterator">logical iterator</a> (in case of an <a data-link-type="dfn|abstract-op" href="#dfn-iterable-field" class="internalDFN" id="ref-for-dfn-iterable-field-3">iterable field</a>) on the <a data-link-type="dfn|abstract-op" href="#dfn-parent-records" class="internalDFN" id="ref-for-dfn-parent-records-1">parent records</a>, the <dfn id="dfn-parent-records" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">parent records</dfn> being the records in the record sequence defined by the field's <a data-link-type="dfn|abstract-op" href="#dfn-parent" class="internalDFN" id="ref-for-dfn-parent-3">parent</a>. For a given <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-23">field</a>, the <a data-link-type="dfn|abstract-op" href="#dfn-field-record-sequence" class="internalDFN" id="ref-for-dfn-field-record-sequence-2">field record sequence</a> has these keys and corresponding values:</p>
<ul>
<li>An index key <code>{fieldName}.#</code> with as values the position of the current entry in the <a data-link-type="dfn|abstract-op" href="#dfn-field-record-sequence" class="internalDFN" id="ref-for-dfn-field-record-sequence-3">field record sequence</a>.</li>
<li>A key <code>{fieldName}</code> with as values the records in the <a data-link-type="dfn|abstract-op" href="#dfn-field-record-sequence" class="internalDFN" id="ref-for-dfn-field-record-sequence-4">field record sequence</a>.</li>
</ul>
<aside class="example" id="ex-field-record-sequence"><div class="marker">
    <a class="self-link" href="#ex-field-record-sequence">Example<bdi> 12</bdi></a>
  </div>

<p>In this example a <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-24">field</a> with <a data-link-type="dfn|abstract-op" href="#dfn-declared-name" class="internalDFN" id="ref-for-dfn-declared-name-3">declared name</a> "item" is added to the <a data-link-type="dfn|abstract-op" href="#dfn-logical-view" class="internalDFN" id="ref-for-dfn-logical-view-6">logical view</a> from <a href="#ex-field" data-matched-text="[[[#ex-field]]]" class="box-ref">Example<bdi> 11</bdi></a>. Additionally a nested <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-25">field</a> "type" and a nested <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-26">field</a> "weight" are added to the "item" <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-27">field</a>, .</p>
<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:jsonView</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalView</span> ;
  <span class="hljs-symbol">rml:viewOn</span> <span class="hljs-symbol">:jsonSource</span> ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"name"</span> ;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"$.name"</span> ;
  ] ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:IterableField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"item"</span> ;
    <span class="hljs-symbol">rml:iterator</span> <span class="hljs-string">"$.items[*]"</span> ;
    <span class="hljs-symbol">rml:field</span> [
      <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ; 
      <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"type"</span> ;
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"$.type"</span> ;
    ] ;
    <span class="hljs-symbol">rml:field</span> [
      <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ; 
      <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"weight"</span> ;
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"$.weight"</span> ;
    ] ;
  ] .
</code></pre>
</aside>
Note some columns in the table below have been shortened for brevity.
<aside class="ex-intermediate">
 --&gt;
 --&gt;
 --&gt;
<table>
<tbody><tr><th>#</th>
<th>

<p><code>&lt;it&gt;</code></p>
</th>
<th>name.#</th>
<th>name</th>
<th>item.#</th>
<th>item</th>
<th>item.type.#</th>
<th>item.type</th>
<th>item.weight.#</th>
<th>item.weight</th> 
</tr><tr>
<td>0</td>
<td>

<pre><code class="json hljs" aria-busy="false">
{...}
</code></pre>
</td>
<td>0</td>
<td>alice</td>
<td>0</td>
<td>

<pre><code class="json hljs" aria-busy="false">{...}
</code></pre>
</td>
<td>0</td>
<td>sword</td>
<td>0</td>
<td>1500</td></tr>
<tr>
<td>0</td>
<td>

<pre><code class="json hljs" aria-busy="false">{...}
</code></pre>
</td>
<td>0</td>
<td>alice</td>
<td>1</td>
<td>

<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"shield"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2500</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</td>
<td>0</td>
<td>shield</td>
<td>0</td>
<td>2500</td></tr>
<tr>
<td>1</td>
<td>

<pre><code class="json hljs" aria-busy="false">{...}
</code></pre>
</td>
<td>0</td>
<td>bob</td>
<td>0</td>
<td>

<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"flower"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</td>
<td>0</td>
<td>flower</td>
<td>0</td>
<td>15</td></tr>
</tbody></table>

</aside>

</aside>

</section><section id="field-reference-formulations"><div class="header-wrapper"><h3 id="fieldreferenceformulations"><bdi class="secno">5.4 </bdi>Field reference formulations</h3><a class="self-link" href="#fieldreferenceformulations" aria-label="Permalink for Section 5.4"></a></div><p>For the evaluation of the expression of an <a data-link-type="dfn|abstract-op" href="#dfn-expression-field" class="internalDFN" id="ref-for-dfn-expression-field-4">expression field</a> (<code>rml:ExpressionField</code>) on the records of the field's <a data-link-type="dfn|abstract-op" href="#dfn-parent" class="internalDFN" id="ref-for-dfn-parent-4">parent</a>, the parent's <a href="https://w3id.org/rml/core/spec##dfn-reference-formulation">reference formulation</a> is used. 
Consequently, the parent of an <a data-link-type="dfn|abstract-op" href="#dfn-expression-field" class="internalDFN" id="ref-for-dfn-expression-field-5">expression field</a> <em class="rfc2119">MUST</em> be an <a href="https://w3id.org/rml/core/spec##dfn-iterable">iterable</a>, i.e. an <a href="https://w3id.org/rml/core/spec##dfn-abstract-logical-source">abstract logical source</a> or <a data-link-type="dfn|abstract-op" href="#dfn-iterable-field" class="internalDFN" id="ref-for-dfn-iterable-field-4">iterable field</a>.  </p>
<p>The default <a href="https://w3id.org/rml/core/spec##dfn-reference-formulation">reference formulation</a> of an <a data-link-type="dfn|abstract-op" href="#dfn-iterable-field" class="internalDFN" id="ref-for-dfn-iterable-field-5">iterable field</a> (<code>rml:IterableField</code>) is the <a href="https://w3id.org/rml/core/spec##dfn-reference-formulation">reference formulation</a> of the field's <a data-link-type="dfn|abstract-op" href="#dfn-parent" class="internalDFN" id="ref-for-dfn-parent-5">parent</a>. 
If the <a data-link-type="dfn|abstract-op" href="#dfn-iterable-field" class="internalDFN" id="ref-for-dfn-iterable-field-6">iterable field</a>'s <a data-link-type="dfn|abstract-op" href="#dfn-parent" class="internalDFN" id="ref-for-dfn-parent-6">parent</a> is an <a data-link-type="dfn|abstract-op" href="#dfn-expression-field" class="internalDFN" id="ref-for-dfn-expression-field-6">expression field</a>, a <a href="https://w3id.org/rml/core/spec##dfn-reference-formulation">reference formulation</a> <em class="rfc2119">MUST</em> be declared for the <a data-link-type="dfn|abstract-op" href="#dfn-iterable-field" class="internalDFN" id="ref-for-dfn-iterable-field-7">iterable field</a>.
Declaring a new <a href="https://w3id.org/rml/core/spec##dfn-reference-formulation">reference formulation</a>, i.e. a <a href="https://w3id.org/rml/core/spec##dfn-reference-formulation">reference formulation</a> that is different from the <a href="https://w3id.org/rml/core/spec##dfn-reference-formulation">reference formulation</a> of the field's <a data-link-type="dfn|abstract-op" href="#dfn-parent" class="internalDFN" id="ref-for-dfn-parent-7">parent</a>, is only allowed when the field's <a data-link-type="dfn|abstract-op" href="#dfn-parent" class="internalDFN" id="ref-for-dfn-parent-8">parent</a> is an <a data-link-type="dfn|abstract-op" href="#dfn-expression-field" class="internalDFN" id="ref-for-dfn-expression-field-7">expression field</a>. </p>
<aside class="example" id="ex-mixed-format-json-csv"><div class="marker">
    <a class="self-link" href="#ex-mixed-format-json-csv">Example<bdi> 13</bdi></a>
  </div>

<p>In this example a <a data-link-type="dfn|abstract-op" href="#dfn-logical-view" class="internalDFN" id="ref-for-dfn-logical-view-7">logical view</a> is defined on a <a href="https://w3id.org/rml/core/spec#dfn-logical-source">logical source</a> with reference formulation <code>rml:JSONPath</code>.
The <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-28">field</a> with <a data-link-type="dfn|abstract-op" href="#dfn-declared-name" class="internalDFN" id="ref-for-dfn-declared-name-4">declared name</a> "items" is evaluated using this <a href="https://w3id.org/rml/core/spec#dfn-reference-formulation">reference formulation</a>.
The nested <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-29">field</a> with <a data-link-type="dfn|abstract-op" href="#dfn-declared-name" class="internalDFN" id="ref-for-dfn-declared-name-5">declared name</a> "item" has a declared <a href="https://w3id.org/rml/core/spec#dfn-reference-formulation">reference formulation</a> <code>rml:CSV</code> and CSV row as implicit iterator. 
Its records are a sequence of logical iterations defined by its iterator. 
The nested fields with <a data-link-type="dfn|abstract-op" href="#dfn-declared-name" class="internalDFN" id="ref-for-dfn-declared-name-6">declared name</a> "type" and "weight" are evaluated using the reference formulation <code>rml:CSV</code> from their parent field with <a data-link-type="dfn|abstract-op" href="#dfn-declared-name" class="internalDFN" id="ref-for-dfn-declared-name-7">declared name</a> "item".</p>
<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"people"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"alice"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"type,weight\nsword,1500\nshield,2500"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bob"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"type,weight\nflower,15"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>  
</code></pre>
</aside>
<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:mixedJSONSource</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalSource</span> ;
  <span class="hljs-symbol">rml:source</span> <span class="hljs-symbol">:mixedJSONFile</span> ;
  <span class="hljs-symbol">rml:referenceFormulation</span> <span class="hljs-symbol">rml:JSONPath</span> ;
  <span class="hljs-symbol">rml:iterator</span> <span class="hljs-string">"$.people[*]"</span> .

<span class="hljs-symbol">:mixedJSONView</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalView</span> ;
  <span class="hljs-symbol">rml:viewOn</span> <span class="hljs-symbol">:mixedJSONSource</span> ;
  <span class="hljs-symbol">rml:field</span> [ 
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"items"</span> ;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"$.items"</span> ;
    <span class="hljs-symbol">rml:field</span> [ 
      <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:IterableField</span> ; 
      <span class="hljs-symbol">rml:referenceFormulation</span> <span class="hljs-symbol">rml:CSV;</span>
      <span class="hljs-symbol">rml:field</span> [ 
        <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ; 
        <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"type"</span> ;
        <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"type"</span> ;
      ] ;
      <span class="hljs-symbol">rml:field</span> [ 
        <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField;</span>
        <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"weight"</span> ;
        <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"weight"</span> ;
      ] ;
    ] ; 
  ] .
</code></pre>
</aside>
Note some columns in the table below have been shortened for brevity.
<aside class="ex-intermediate">
<table>
<tbody><tr>
<td>#</td>
<td>&lt;it&gt;</td>
<td>items</td>
<td>items.#</td>
<td>item</td>
<td>item.#</td>
<td>item.type</td>
<td>item.type.#</td>
<td>item.weight</td>
<td>item.weight.#</td>
</tr>
<tr>
<td>0</td>
<td>

<pre><code class="json hljs" aria-busy="false">
{...}
</code></pre>
</td>
<td>type,weight\nsword,1500\nshield,2500</td>
<td>0</td>
<td>sword,1500</td>
<td>0</td>
<td>sword</td>
<td>0</td>
<td>1500</td>
<td>0</td>
</tr>
<tr>
<td>0</td>
<td>

<pre><code class="json hljs" aria-busy="false">
{...}
</code></pre>
</td>
<td>type,weight\nsword,1500\nshield,2500</td>
<td>0</td>
<td>shield,2500</td>
<td>1</td>
<td>shield</td>
<td>0</td>
<td>2500</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>

<pre><code class="json hljs" aria-busy="false">
{...}
</code></pre>
</td>
<td>type,weight\nflower,15</td>
<td>0</td>
<td>flower,15</td>
<td>0</td>
<td>flower</td>
<td>0</td>
<td>15</td>
<td>0</td>
</tr>
</tbody></table>
</aside>

</section><section id="using-field-names-in-triples-maps"><div class="header-wrapper"><h3 id="x5-5-using-field-names-in-triples-maps"><bdi class="secno">5.5 </bdi>Using field names in triples maps</h3><a class="self-link" href="#using-field-names-in-triples-maps" aria-label="Permalink for Section 5.5"></a></div>
<p>A <dfn data-plurals="field references" id="dfn-field-reference" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">field reference</dfn> is a <a href="https://w3id.org/rml/core/spec#dfn-reference-expression">reference expression</a> that references a defined <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-30">field</a>. 
A <a data-link-type="dfn|abstract-op" href="#dfn-field-reference" class="internalDFN" id="ref-for-dfn-field-reference-1">field reference</a> <em class="rfc2119">MUST</em> be a defined <a data-link-type="dfn|abstract-op" href="#dfn-field-name" class="internalDFN" id="ref-for-dfn-field-name-2">field name</a> of an <a data-link-type="dfn|abstract-op" href="#dfn-expression-field" class="internalDFN" id="ref-for-dfn-expression-field-8">expression field</a>, to obtain the records in the <a data-link-type="dfn|abstract-op" href="#dfn-field-record-sequence" class="internalDFN" id="ref-for-dfn-field-record-sequence-5">field record sequence</a>, or a defined <a data-link-type="dfn|abstract-op" href="#dfn-field-name" class="internalDFN" id="ref-for-dfn-field-name-3">field name</a> followed by the string <code>.#</code> of a <a data-link-type="dfn|abstract-op" href="#dfn-field" class="internalDFN" id="ref-for-dfn-field-31">field</a>, to obtain the index key of the position of the current entry in the <a data-link-type="dfn|abstract-op" href="#dfn-field-record-sequence" class="internalDFN" id="ref-for-dfn-field-record-sequence-6">field record sequence</a>. 
A <a data-link-type="dfn|abstract-op" href="#dfn-field-reference" class="internalDFN" id="ref-for-dfn-field-reference-2">field reference</a> is a special type of <a href="https://w3id.org/rml/core/spec#dfn-reference-expression">reference expression</a> for which no reference formulation need be defined.</p>
<p>A <a data-link-type="dfn|abstract-op" href="#dfn-field-reference" class="internalDFN" id="ref-for-dfn-field-reference-3">field reference</a> can be used in <a href="https://w3id.org/rml/core/spec#dfn-expression-map">expression maps</a> just as any other <a href="https://w3id.org/rml/core/spec#dfn-reference-expression">reference expression</a>.</p>
<aside class="example" id="ex-field-in-triples-map"><div class="marker">
    <a class="self-link" href="#ex-field-in-triples-map">Example<bdi> 14</bdi></a>
  </div>

<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:jsonView</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalView</span> ;
  <span class="hljs-symbol">rml:viewOn</span> <span class="hljs-symbol">:jsonSource</span> ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"name"</span> ;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"$.name"</span> ;
  ] ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:IterableField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"item"</span> ;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"$.items[*]"</span> ;
    <span class="hljs-symbol">rml:field</span> [
      <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
      <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"type"</span> ;
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"$.type"</span> ;
    ] ;
    <span class="hljs-symbol">rml:field</span> [
      <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
      <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"weight"</span> ;
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"$.weight"</span> ;
    ] ;
  ] .
</code></pre>
</aside>

<p>Note some columns in the table below have been shortened for brevity.</p>
<aside class="ex-intermediate">
<table>
<tbody><tr><th>#</th>
<th>

<p><code>&lt;it&gt;</code></p>
</th>
<th>name.#</th>
<th>name</th>
<th>item.#</th>
<th>item</th>
<th>item.type.#</th>
<th>item.type</th>
<th>item.weight#</th>
<th>item.weight</th>
</tr><tr>
<td>0</td>
<td>

<pre><code class="json hljs" aria-busy="false">{...}
</code></pre>
</td>
<td>0</td>
<td>alice</td>
<td>0</td>
<td>

<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sword"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1500</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</td>
<td>0</td>
<td>sword</td>
<td>0</td>
<td>1500</td>
</tr>
<tr>
<td>0</td>
<td>

<pre><code class="json hljs" aria-busy="false">{...}
</code></pre>
</td>
<td>0</td>
<td>alice</td>
<td>1</td>
<td>

<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"shield"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2500</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</td>
<td>0</td>
<td>shield</td>
<td>0</td>
<td>2500</td>
</tr>
<tr>
<td>1</td>
<td>

<pre><code class="json hljs" aria-busy="false">{...}
</code></pre>
</td>
<td>0</td>
<td>bob</td>
<td>0</td>
<td>

<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"flower"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</td>
<td>0</td>
<td>flower</td>
<td>0</td>
<td>15</td>
</tr>
</tbody></table>

</aside>

<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:triplesMapPerson</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:TriplesMap</span> ;
  <span class="hljs-symbol">rml:logicalSource</span> <span class="hljs-symbol">:jsonView</span> ;
  <span class="hljs-symbol">rml:subjectMap</span> [
    <span class="hljs-symbol">rml:template</span> <span class="hljs-string">"http://example.org/person/{name}"</span> ;
  ] ;
  <span class="hljs-symbol">rml:predicateObjectMap</span> [
    <span class="hljs-symbol">rml:predicate</span> <span class="hljs-symbol">:hasName</span> ;
    <span class="hljs-symbol">rml:objectMap</span> [
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"name"</span> ;
    ] ;
  ] ;
  <span class="hljs-symbol">rml:predicateObjectMap</span> [
    <span class="hljs-symbol">rml:predicate</span> <span class="hljs-symbol">:hasItem</span> ;
    <span class="hljs-symbol">rml:objectMap</span> [
      <span class="hljs-symbol">rml:parentTriplesMap</span> <span class="hljs-symbol">:triplesMapItem</span> ;
    ] ;
  ] .

<span class="hljs-symbol">:triplesMapItem</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:TriplesMap</span> ;
  <span class="hljs-symbol">rml:logicalSource</span> <span class="hljs-symbol">:jsonView</span> ;
  <span class="hljs-symbol">rml:subjectMap</span> [
    <span class="hljs-symbol">rml:template</span> <span class="hljs-string">"http://example.org/person/{name}/item/{item.#}"</span> ;
  ] ;
  <span class="hljs-symbol">rml:predicateObjectMap</span> [
    <span class="hljs-symbol">rml:predicate</span> <span class="hljs-symbol">:hasName</span> ;
    <span class="hljs-symbol">rml:objectMap</span> [
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"item.type"</span> ;
    ] ;
  ] ;
  <span class="hljs-symbol">rml:predicateObjectMap</span> [
    <span class="hljs-symbol">rml:predicate</span> <span class="hljs-symbol">:hasWeight</span> ;
    <span class="hljs-symbol">rml:objectMap</span> [
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"item.weight"</span> ;
    ] ;
  ] .
</code></pre>
</aside>

<aside class="ex-output">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-literal">&lt;http://example.org/person/alice&gt;</span> <span class="hljs-symbol">:hasName</span> <span class="hljs-string">"alice"</span> ;
  <span class="hljs-symbol">:hasItem</span> <span class="hljs-literal">&lt;http://example.org/person/alice/item/0&gt;</span> ,
           <span class="hljs-literal">&lt;http://example.org/person/alice/item/1&gt;</span> .

<span class="hljs-literal">&lt;http://example.org/person/bob&gt;</span> <span class="hljs-symbol">:hasName</span> <span class="hljs-string">"bob"</span> ;
  <span class="hljs-symbol">:hasItem</span> <span class="hljs-literal">&lt;http://example.org/person/bob/item/0&gt;</span> .

<span class="hljs-literal">&lt;http://example.org/person/alice/item/0&gt;</span> <span class="hljs-symbol">:hasName</span> <span class="hljs-string">"sword"</span> ;
  <span class="hljs-symbol">:hasWeight</span> <span class="hljs-number">1500</span> .

<span class="hljs-literal">&lt;http://example.org/person/alice/item/1&gt;</span> <span class="hljs-symbol">:hasName</span> <span class="hljs-string">"shield"</span> ;
  <span class="hljs-symbol">:hasWeight</span> <span class="hljs-number">2500</span> .

<span class="hljs-literal">&lt;http://example.org/person/bob/item/0&gt;</span> <span class="hljs-symbol">:hasName</span> <span class="hljs-string">"flower"</span> ;
  <span class="hljs-symbol">:hasWeight</span> <span class="hljs-number">15</span> .
</code></pre>
</aside>

</aside></section></section>

<section id="logical-view-joins"><div class="header-wrapper"><h2 id="viewjoins"><bdi class="secno">6. </bdi>Logical view joins</h2><a class="self-link" href="#viewjoins" aria-label="Permalink for Section 6."></a></div><p>A <dfn id="dfn-logical-view-join" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">logical view join</dfn> (<code>rml:LogicalViewJoin</code>) is an operation that extends the logical iteration of one logical view (the <a data-link-type="dfn|abstract-op" href="#dfn-child-logical-view" class="internalDFN" id="ref-for-dfn-child-logical-view-1">child logical view</a>) with fields derived from another logical view (the <a data-link-type="dfn|abstract-op" href="#dfn-parent-logical-view" class="internalDFN" id="ref-for-dfn-parent-logical-view-1">parent logical view</a>).</p>
<p>A <a data-link-type="dfn|abstract-op" href="#dfn-logical-view-join" class="internalDFN" id="ref-for-dfn-logical-view-join-2">logical view join</a> (<code>rml:LogicalViewJoin</code>) <em class="rfc2119">MUST</em> contain:</p>
<ul>
<li>exactly one parent logical view property (<code>rml:parentLogicalView</code>), whose value is a <a data-link-type="dfn|abstract-op" href="#dfn-logical-view" class="internalDFN" id="ref-for-dfn-logical-view-8">logical view</a> (<code>rml:LogicalView</code>) that supplies the additional fields, fulfills the role of the <a href="">parent logical source</a> in the <a href="https://w3id.org/rml/core/spec#dfn-join-condition">join condition(s)</a> of the <a data-link-type="dfn|abstract-op" href="#dfn-logical-view-join" class="internalDFN" id="ref-for-dfn-logical-view-join-3">logical view join</a>, and is referred to as <dfn id="dfn-parent-logical-view" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">parent logical view</dfn>.</li>
<li>at least one join condition property (<code>rml:joinCondition</code>), whose value is a <a href="https://w3id.org/rml/core/spec#dfn-join-condition">join condition</a>.</li>
<li>at least one field property (<code>rml:field</code>), whose value is an <a data-link-type="dfn|abstract-op" href="#dfn-expression-field" class="internalDFN" id="ref-for-dfn-expression-field-9">expression field</a> (<code>rml:ExpressionField</code>). This field <em class="rfc2119">SHOULD</em> only contain <a data-link-type="dfn|abstract-op" href="#dfn-field-reference" class="internalDFN" id="ref-for-dfn-field-reference-4">field references</a> that can be evaluated on the parent logical view.</li>
</ul>
<p>The <a data-link-type="dfn|abstract-op" href="#dfn-logical-view" class="internalDFN" id="ref-for-dfn-logical-view-9">logical view</a> in the subject position of the <a data-link-type="dfn|abstract-op" href="#dfn-join-property" class="internalDFN" id="ref-for-dfn-join-property-1">join property</a>, fulfills the role of <a href="">child logical source</a> in the <a href="https://w3id.org/rml/core/spec#dfn-join-condition">join condition(s)</a> of the <a data-link-type="dfn|abstract-op" href="#dfn-logical-view-join" class="internalDFN" id="ref-for-dfn-logical-view-join-4">logical view join</a>, and is referred to as <dfn id="dfn-child-logical-view" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">child logical view</dfn>.</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Domain</th>
<th>Range</th>
</tr>
</thead>
<tbody><tr>
<td><code>rml:parentLogicalView</code></td>
<td><code>rml:LogicalViewJoin</code></td>
<td><code>rml:LogicalView</code></td>
</tr>
<tr>
<td><code>rml:joinCondition</code></td>
<td><code>rml:LogicalViewJoin</code></td>
<td><code>rml:Join</code></td>
</tr>
<tr>
<td><code>rml:field</code></td>
<td><code>rml:LogicalViewJoin</code></td>
<td><code>rml:ExpressionField</code></td>
</tr>
</tbody></table>
<section id="join-types"><div class="header-wrapper"><h3 id="dfn-join-type"><bdi class="secno">6.1 </bdi>Join types</h3><a class="self-link" href="#dfn-join-type" aria-label="Permalink for Section 6.1"></a></div><p>The <dfn id="dfn-join-property" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">join property</dfn> specifies the join type of the <a data-link-type="dfn|abstract-op" href="#dfn-logical-view-join" class="internalDFN" id="ref-for-dfn-logical-view-join-5">logical view join</a>, i.e. a <a data-link-type="dfn|abstract-op" href="#dfn-left-join" class="internalDFN" id="ref-for-dfn-left-join-1">left join</a> or an <a data-link-type="dfn|abstract-op" href="#dfn-inner-join" class="internalDFN" id="ref-for-dfn-inner-join-1">inner join</a>.</p>
<p>A <dfn id="dfn-left-join" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">left join</dfn> (<code>rml:leftJoin</code>) is the equivalent of a left (outer) join in SQL, where the <a data-link-type="dfn|abstract-op" href="#dfn-child-logical-view" class="internalDFN" id="ref-for-dfn-child-logical-view-2">child logical view</a> is the left part of the join, and the <a data-link-type="dfn|abstract-op" href="#dfn-parent-logical-view" class="internalDFN" id="ref-for-dfn-parent-logical-view-2">parent logical view</a> is the right part of the join. If any of the <a href="https://w3id.org/rml/core/spec#dfn-join-condition">join conditions</a> evaluates to <code>false</code>, the fields from the <a data-link-type="dfn|abstract-op" href="#dfn-logical-view-join" class="internalDFN" id="ref-for-dfn-logical-view-join-6">logical view join</a> in the extended logical iteration contain a null value.</p>
<p>An <dfn id="dfn-inner-join" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">inner join</dfn> (<code>rml:innerJoin</code>) is the equivalent of an inner join in SQL. If any of the <a href="https://w3id.org/rml/core/spec#dfn-join-condition">join conditions</a> evaluates to <code>false</code>, the logical iteration is removed from the <a data-link-type="dfn|abstract-op" href="#dfn-child-logical-view" class="internalDFN" id="ref-for-dfn-child-logical-view-3">child logical view</a>.</p>
</section><section id="logical-view-join-examples"><div class="header-wrapper"><h3 id="x6-2-logical-view-join-examples"><bdi class="secno">6.2 </bdi>Logical view join examples</h3><a class="self-link" href="#logical-view-join-examples" aria-label="Permalink for Section 6.2"></a></div>
<section id="left-join"><div class="header-wrapper"><h4 id="x6-2-1-left-join"><bdi class="secno">6.2.1 </bdi>Left join</h4><a class="self-link" href="#left-join" aria-label="Permalink for Section 6.2.1"></a></div>
<aside class="example" id="ex-leftjoin"><div class="marker">
    <a class="self-link" href="#ex-leftjoin">Example<bdi> 15</bdi></a>
  </div>

<p>In this example a <a data-link-type="dfn|abstract-op" href="#dfn-logical-view" class="internalDFN" id="ref-for-dfn-logical-view-10">logical view</a> with fields built with data from the logical source from <a href="#csviterator" data-matched-text="[[[#csviterator]]]" class="box-ref">Example<bdi> 4</bdi></a> is joined with the logical view from <a href="#ex-field-record-sequence" data-matched-text="[[[#ex-field-record-sequence]]]" class="box-ref">Example<bdi> 12</bdi></a>. 
In case of a left join (as in the example), this results in 4 logical iterations in the logical view. 
If an inner joins would have been used, the logical view would have only 3 logical iterations. </p>
<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:csvView</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalView</span> ;
  <span class="hljs-symbol">rml:viewOn</span> <span class="hljs-symbol">:csvSource</span> ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ; 
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"name"</span> ;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"name"</span> ;
  ] ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"birthyear"</span> ;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"birthyear"</span> ;
  ] ;
  <span class="hljs-symbol">rml:leftJoin</span> [
    <span class="hljs-symbol">rml:parentLogicalView</span> <span class="hljs-symbol">:jsonView</span> ;
    <span class="hljs-symbol">rml:joinCondition</span> [
      <span class="hljs-symbol">rml:parent</span> <span class="hljs-string">"name"</span> ;
      <span class="hljs-symbol">rml:child</span> <span class="hljs-string">"name"</span> ;
    ] ; 
    <span class="hljs-symbol">rml:field</span> [
      <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ; 
      <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"item_type"</span> ;
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"item.type"</span> ;
    ] ;
    <span class="hljs-symbol">rml:field</span> [
      <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
      <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"item_weight"</span> ;
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"item.weight"</span> ;
    ] ;
  ] .
</code></pre>
</aside>

<aside class="ex-intermediate">
<table>
    <tbody><tr>
        <td>#</td>
        <td>&lt;it&gt;</td>
        <td>name.#</td>
        <td>name</td>
        <td>birthyear.#</td>
        <td>birthyear</td>
        <td>item_type.#</td>
        <td>item_type</td>
        <td>item_weight.#</td>
        <td>item_weight </td>
    </tr>
    <tr>
        <td>0</td>
        <td>(row)</td>
        <td>0</td>
        <td>alice</td>
        <td>0</td>
        <td>1995</td>
        <td>0</td>
        <td>sword</td>
        <td>0</td>
        <td>1500 </td>
    </tr>
    <tr>
        <td>0</td>
        <td>(row)</td>
        <td>0</td>
        <td>alice</td>
        <td>0</td>
        <td>1995</td>
        <td>1</td>
        <td>shield</td>
        <td>1</td>
        <td>2500 </td>
    </tr>
    <tr>
        <td>1</td>
        <td>(row)</td>
        <td>0</td>
        <td>bob</td>
        <td>0</td>
        <td>1999</td>
        <td>0</td>
        <td>flower</td>
        <td>0</td>
        <td>15 </td>
    </tr>
    <tr>
        <td>2</td>
        <td>(row)</td>
        <td>0</td>
        <td>tobias</td>
        <td>0</td>
        <td>2005</td>
        <td>null</td>
        <td>null</td>
        <td>null</td>
        <td>null </td>
    </tr>
</tbody></table>

</aside>
</aside>

</section><section id="inner-join"><div class="header-wrapper"><h4 id="x6-2-2-inner-join"><bdi class="secno">6.2.2 </bdi>Inner join</h4><a class="self-link" href="#inner-join" aria-label="Permalink for Section 6.2.2"></a></div>
<aside class="example" id="ex-innerjoin"><div class="marker">
    <a class="self-link" href="#ex-innerjoin">Example<bdi> 16</bdi></a>
  </div>

<p>When an inner join is used, the resulting logical view has only 3 logical iterations.</p>
<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:csvView</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalView</span> ;
  <span class="hljs-symbol">rml:viewOn</span> <span class="hljs-symbol">:csvSource</span> ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"name"</span> ;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"name"</span> ;
  ] ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"birthyear"</span> ;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"birthyear"</span> ;
  ] ;
  <span class="hljs-symbol">rml:leftJoin</span> [
    <span class="hljs-symbol">rml:parentLogicalView</span> <span class="hljs-symbol">:jsonView</span>
    <span class="hljs-symbol">rml:joinCondition</span> [
      <span class="hljs-symbol">rml:parent</span> <span class="hljs-string">"name"</span> ;
      <span class="hljs-symbol">rml:child</span> <span class="hljs-string">"name"</span> ;
    ] ; 
    <span class="hljs-symbol">rml:field</span> [
      <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
      <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"item_type"</span> ;
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"item.type"</span> ;
    ] ;
    <span class="hljs-symbol">rml:field</span> [
      <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
      <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"item_weight"</span> ;
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"item.weight"</span> ;
    ] ;
  ] .
</code></pre>
</aside>

<aside class="ex-intermediate">
<table>
    <tbody><tr>
        <td>#</td>
        <td>&lt;it&gt;</td>
        <td>name.#</td>
        <td>name</td>
        <td>birthyear.#</td>
        <td>birthyear</td>
        <td>item_type.#</td>
        <td>item_type</td>
        <td>item_weight.#</td>
        <td>item_weight </td>
    </tr>
    <tr>
        <td>0</td>
        <td>(row)</td>
        <td>0</td>
        <td>alice</td>
        <td>0</td>
        <td>1995</td>
        <td>0</td>
        <td>sword</td>
        <td>0</td>
        <td>1500 </td>
    </tr>
    <tr>
        <td>0</td>
        <td>(row)</td>
        <td>0</td>
        <td>alice</td>
        <td>0</td>
        <td>1995</td>
        <td>1</td>
        <td>shield</td>
        <td>1</td>
        <td>2500 </td>
    </tr>
    <tr>
        <td>1</td>
        <td>(row)</td>
        <td>0</td>
        <td>bob</td>
        <td>0</td>
        <td>1999</td>
        <td>0</td>
        <td>flower</td>
        <td>0</td>
        <td>15 </td>
    </tr>
</tbody></table>

</aside>
</aside>


</section><section id="two-left-joins"><div class="header-wrapper"><h4 id="x6-2-3-two-left-joins"><bdi class="secno">6.2.3 </bdi>Two left joins</h4><a class="self-link" href="#two-left-joins" aria-label="Permalink for Section 6.2.3"></a></div>
<aside class="example" id="ex-twoleftjoins"><div class="marker">
    <a class="self-link" href="#ex-twoleftjoins">Example<bdi> 17</bdi></a>
  </div>

<p>In this example a second <a data-link-type="dfn|abstract-op" href="#dfn-logical-view-join" class="internalDFN" id="ref-for-dfn-logical-view-join-7">logical view join</a> is added to the <a data-link-type="dfn|abstract-op" href="#dfn-logical-view" class="internalDFN" id="ref-for-dfn-logical-view-11">logical view</a> from <a href="#ex-leftjoin" data-matched-text="[[[#ex-leftjoin]]]" class="box-ref">Example<bdi> 15</bdi></a>. The <a data-link-type="dfn|abstract-op" href="#dfn-parent-logical-view" class="internalDFN" id="ref-for-dfn-parent-logical-view-3">parent logical view</a> of this second join is derived from logical source <code>:additionalCsvSource</code> with below input data.</p>
<aside class="ex-input">

<pre><code class="csv hljs" aria-busy="false">name,id
alice,123
bob,456
tobias,789
</code></pre>
</aside>

<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:additionalCsvView</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalView</span> ;
  <span class="hljs-symbol">rml:viewOn</span> <span class="hljs-symbol">:additioncalCsvSource</span> ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"name"</span> ;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"name"</span> ;
  ] ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"id"</span> ;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"id"</span> ;
  ] . 

<span class="hljs-symbol">:csvView</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalView</span> ;
  <span class="hljs-symbol">rml:viewOn</span> <span class="hljs-symbol">:csvSource</span> ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"name"</span> ;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"name"</span> ;
  ] ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"birthyear"</span> ;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"birthyear"</span> ;
  ] ;
  <span class="hljs-symbol">rml:leftJoin</span> [
    <span class="hljs-symbol">rml:parentLogicalView</span> <span class="hljs-symbol">:jsonView</span> ;
    <span class="hljs-symbol">rml:joinCondition</span> [
      <span class="hljs-symbol">rml:parent</span> <span class="hljs-string">"name"</span> ;
      <span class="hljs-symbol">rml:child</span> <span class="hljs-string">"name"</span> ;
    ] ; 
    <span class="hljs-symbol">rml:field</span> [
      <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
      <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"item_type"</span> ;
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"item.type"</span> ;
    ] ;
    <span class="hljs-symbol">rml:field</span> [
      <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
      <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"item_weight"</span> ;
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"item.weight"</span> ;
    ] ;
  ] ; 
  <span class="hljs-symbol">rml:leftJoin</span> [
    <span class="hljs-symbol">rml:parentLogicalView</span> <span class="hljs-symbol">:additionalCsvView</span> ;
    <span class="hljs-symbol">rml:joinCondition</span> [
      <span class="hljs-symbol">rml:parent</span> <span class="hljs-string">"name"</span> ;
      <span class="hljs-symbol">rml:child</span> <span class="hljs-string">"name"</span> ;
    ] ; 
    <span class="hljs-symbol">rml:field</span> [
      <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
      <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"id"</span> ;
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"id"</span> ;
    ] ;
  ] .
</code></pre>
</aside>

<aside class="ex-intermediate">
<table>
    <tbody><tr>
        <td>#</td>
        <td>&lt;it&gt;</td>
        <td>name.#</td>
        <td>name</td>
        <td>birthyear.#</td>
        <td>birthyear</td>
        <td>item_type.#</td>
        <td>item_type</td>
        <td>item_weight.#</td>
        <td>item_weight</td>
        <td>id#</td>
        <td>id</td>
    </tr>
    <tr>
        <td>0</td>
        <td>(row)</td>
        <td>0</td>
        <td>alice</td>
        <td>0</td>
        <td>1995</td>
        <td>0</td>
        <td>sword</td>
        <td>0</td>
        <td>1500 </td>
        <td>0</td>
        <td>123</td>
    </tr>
    <tr>
        <td>0</td>
        <td>(row)</td>
        <td>0</td>
        <td>alice</td>
        <td>0</td>
        <td>1995</td>
        <td>1</td>
        <td>shield</td>
        <td>1</td>
        <td>2500 </td>
        <td>0</td>
        <td>123</td>
    </tr>
    <tr>
        <td>1</td>
        <td>(row)</td>
        <td>0</td>
        <td>bob</td>
        <td>0</td>
        <td>1999</td>
        <td>0</td>
        <td>flower</td>
        <td>0</td>
        <td>15 </td>
        <td>0</td>
        <td>456</td>
    </tr>
    <tr>
        <td>2</td>
        <td>(row)</td>
        <td>0</td>
        <td>tobias</td>
        <td>0</td>
        <td>2005</td>
        <td>null</td>
        <td>null</td>
        <td>null</td>
        <td>null </td>
        <td>0</td>
        <td>789</td>
    </tr>
</tbody></table>

</aside>
</aside></section></section></section>

<section id="structural-annotations"><div class="header-wrapper"><h2 id="annotations"><bdi class="secno">7. </bdi>Structural Annotations</h2><a class="self-link" href="#annotations" aria-label="Permalink for Section 7."></a></div><p><dfn data-plurals="structural annotation" id="dfn-structural-annotations" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Structural annotations</dfn> provide a mechanism to express relationships between logical views, as well as additional information about fields.</p>
<p>Each <a data-link-type="dfn|abstract-op" href="#dfn-logical-view" class="internalDFN" id="ref-for-dfn-logical-view-12">logical view</a> <em class="rfc2119">MAY</em> have zero or more <a data-link-type="dfn|abstract-op" href="#dfn-structural-annotations" class="internalDFN" id="ref-for-dfn-structural-annotations-1">structural annotation</a> properties (<code>rml:structuralAnnotation</code>), connecting the logical view to a structural annotation object (i.e., of type <code>rml:StructuralAnnotation</code>).</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Domain</th>
<th>Range</th>
</tr>
</thead>
<tbody><tr>
<td><code>rml:structuralAnnotation</code></td>
<td><code>rml:LogicalView</code></td>
<td><code>rml:StructuralAnnotation</code></td>
</tr>
</tbody></table>
<p>Following <a data-link-type="dfn|abstract-op" href="#dfn-structural-annotations" class="internalDFN" id="ref-for-dfn-structural-annotations-2">structural annotations</a> <em class="rfc2119">MAY</em> be defined:</p>
<ul>
<li><a data-link-type="dfn|abstract-op" href="#dfn-unique-annotation" class="internalDFN" id="ref-for-dfn-unique-annotation-1">Unique annotation</a> (<code>rml:UniqueAnnotation</code>)</li>
<li><a data-link-type="dfn|abstract-op" href="#dfn-foreignkey-annotation" class="internalDFN" id="ref-for-dfn-foreignkey-annotation-1">ForeignKey annotation</a> (<code>rml:ForeignKeyAnnotation</code>)</li>
<li><a data-link-type="dfn|abstract-op" href="#dfn-notnull-annotation" class="internalDFN" id="ref-for-dfn-notnull-annotation-1">NotNull annotation</a> (<code>rml:NotNullAnnotation</code>)</li>
<li><a data-link-type="dfn|abstract-op" href="#dfn-irisafe-annotation" class="internalDFN" id="ref-for-dfn-irisafe-annotation-1">IriSafe annotation</a> (<code>rml:IriSafeAnnotation</code>)</li>
<li><a data-link-type="dfn|abstract-op" href="#dfn-primarykey-annotation" class="internalDFN" id="ref-for-dfn-primarykey-annotation-1">PrimaryKey annotation</a> (<code>rml:PrimaryKeyAnnotation</code>)</li>
<li><a data-link-type="dfn|abstract-op" href="#dfn-inclusion-annotation" class="internalDFN" id="ref-for-dfn-inclusion-annotation-1">Inclusion annotation</a> (<code>rml:InclusionAnnotation</code>)</li>
</ul>
<p>All structural annotations of a logical view <i>lv</i> <em class="rfc2119">MUST</em> have an <dfn id="dfn-on-fields" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">on fields</dfn> property (<code>rml:onFields</code>), linking the structural annotation to a list of field names occurring in <i>lv</i>. Intuitively, property <a data-link-type="dfn|abstract-op" href="#dfn-on-fields" class="internalDFN" id="ref-for-dfn-on-fields-1">on fields</a> specifies the fields in <i>lv</i> that are involved by the structural annotation. The semantics of this involvement depends on the specific annotation.</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Domain</th>
<th>Range</th>
</tr>
</thead>
<tbody><tr>
<td><code>rml:onFields</code></td>
<td><code>rml:StructuralAnnotation</code></td>
<td><code>rdf:List</code></td>
</tr>
</tbody></table>
<section id="invariance-principle"><div class="header-wrapper"><h3 id="x7-1-invariance-principle"><bdi class="secno">7.1 </bdi>Invariance Principle</h3><a class="self-link" href="#invariance-principle" aria-label="Permalink for Section 7.1"></a></div>
<p>Structural annotations provide additional information about the data that might be used by the RML processor to optimize the KG construction process. If this additional information is incorrect, then the RML processor might either fail or produce wrong results. When using structural annotations, users should make sure that the following invariance principle is satisfied:</p>
<p><i>For any source instances, the RDF graph produced by the RML engine using an <a href="https://w3id.org/rml/core/spec#dfn-rml-mapping">RML mapping</a> with annotations, and the same  <a href="https://w3id.org/rml/core/spec#dfn-rml-mapping">RML mapping</a> where annotations have been removed, <em class="rfc2119">MUST</em> be the same.</i></p>
<p>We emphasize that RML engines might exploit structural annotations, as they could totally ignore them. It is responsibility of the user to make sure that the annotations provided are indeed correct (that is, the data complies with the annotations). Sanity checks <em class="rfc2119">MAY</em> be provided by the RML engines themselves, but this is not mandatory. Note that providing wrong annotations to an engine that takes into account for annotations, for instance for applying optimizations, could result in a violation of the invariance principle, with unpredictable results.</p>
</section><section id="irisafe"><div class="header-wrapper"><h3 id="x7-2-irisafe"><bdi class="secno">7.2 </bdi>IriSafe</h3><a class="self-link" href="#irisafe" aria-label="Permalink for Section 7.2"></a></div>
<p>An <dfn data-lt="IriSafe annotation|IriSafe structural annotation" id="dfn-irisafe-annotation" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">IriSafe structural annotation</dfn> (<code>rml:IriSafeAnnotation</code>) <a data-link-type="dfn|abstract-op" href="#dfn-on-fields" class="internalDFN" id="ref-for-dfn-on-fields-2">on fields</a> <em>F</em> indicates that the content of each field in <em>F</em> is <a href="https://www.w3.org/TR/r2rml/#dfn-iri-safe">IRI safe</a>, that is, each field in <em>F</em> does not contain any character that is not in the <a href="http://tools.ietf.org/html/rfc3987#section-2.2"><code>iunreserved</code> production</a> in <a href="http://tools.ietf.org/html/rfc3987">RFC3987</a>.</p>
</section><section id="primarykey"><div class="header-wrapper"><h3 id="x7-3-primarykey"><bdi class="secno">7.3 </bdi>PrimaryKey</h3><a class="self-link" href="#primarykey" aria-label="Permalink for Section 7.3"></a></div>
<p>A <dfn data-lt="PrimaryKey annotation|PrimaryKey structural annotation" id="dfn-primarykey-annotation" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">PrimaryKey structural annotation</dfn>  (<code>rml:PrimaryKeyAnnotation</code>) <a data-link-type="dfn|abstract-op" href="#dfn-on-fields" class="internalDFN" id="ref-for-dfn-on-fields-3">on fields</a>  <em>(f1, ..., fn)</em>  imposes two conditions:</p>
<ul>
<li>no duplicate record sequences are present over the list of fields <em>(f1, ..., fn)</em>;</li>
<li>No <code>NULL</code> value is admitted in any of the field <em>f1, ..., fn</em>.</li>
</ul>
<p>Each <a data-link-type="dfn|abstract-op" href="#dfn-logical-view" class="internalDFN" id="ref-for-dfn-logical-view-13">logical view</a> <em class="rfc2119">MAY</em> specify AT MOST ONE <a data-link-type="dfn|abstract-op" href="#dfn-primarykey-annotation" class="internalDFN" id="ref-for-dfn-primarykey-annotation-2">PrimaryKey annotation</a>.</p>
<aside class="example" id="primary-key"><div class="marker">
    <a class="self-link" href="#primary-key">Example<bdi> 18</bdi></a>
  </div>

<p> Consider the following CSV file containing birthdays of people:</p>
<aside class="ex-input">

<pre><code class="csv hljs" aria-busy="false">name,birthyear
alice,1995
bob,1999
tobias,2005
lukas, 1986
</code></pre>
</aside>

<p>Now, assume that we know:</p>
<ul>
<li>Attribute <code>name</code> in the CSV is "UNIQUE" and "NOT NULL";</li>
</ul>
<p>Such a constraint naturally corresponds to the notion of <code>PRIMARY KEY</code> from the world of relational databases. This fact could be valuable information for the RML engine, especially in the virtual setting. However, note that constraints cannot be expressed on CSV files.</p>
<p>We can exploit the mechanism of structural annotations to inform the RML engine about the existence of this constraint. We here work-out an example.</p>
<p>First, we specify the logical source corresponding to the CSV file:</p>
<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:csvSource</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalSource</span> ;
  <span class="hljs-symbol">rml:source</span> <span class="hljs-symbol">:csvFile</span> ;
  <span class="hljs-symbol">rml:referenceFormulation</span> <span class="hljs-symbol">rml:CSV</span> .
</code></pre>
</aside>

<p>We are now ready to specify our logical view and associated <code>rml:primaryKeyAnnotation</code>.</p>
<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:csvSource</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalView</span> ;
  <span class="hljs-symbol">rml:viewOn</span> <span class="hljs-symbol">:csvSource</span> ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"name"</span>;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"name"</span>
 ];
 <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"birthday"</span>;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"birthday"</span>
 ];
 <span class="hljs-symbol">rml:structuralAnnotation</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:primaryKeyAnnotation;</span>
    <span class="hljs-symbol">rml:onFields</span> (<span class="hljs-string">"name"</span>)
 ].
</code></pre>
</aside>
</aside>

</section><section id="unique"><div class="header-wrapper"><h3 id="x7-4-unique"><bdi class="secno">7.4 </bdi>Unique</h3><a class="self-link" href="#unique" aria-label="Permalink for Section 7.4"></a></div>
<p>The <dfn data-lt="Unique annotation|Unique structural annotation" id="dfn-unique-annotation" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Unique structural annotation</dfn> (<code>rml:UniqueAnnotation</code>) is analogous to the notion of <i>UNIQUE constraints</i> in databases. Specifically, a <a data-link-type="dfn|abstract-op" href="#dfn-unique-annotation" class="internalDFN" id="ref-for-dfn-unique-annotation-2">Unique annotation</a> <a data-link-type="dfn|abstract-op" href="#dfn-on-fields" class="internalDFN" id="ref-for-dfn-on-fields-4">on fields</a>  <em>(f1, ..., fn)</em>  imposes the following condition:</p>
<ul>
<li>no duplicate record sequences are present over the list of fields <em>(f1, ..., fn)</em>.</li>
</ul>
<p>Note that every <a data-link-type="dfn|abstract-op" href="#dfn-primarykey-annotation" class="internalDFN" id="ref-for-dfn-primarykey-annotation-3">PrimaryKey annotation</a> is, as a matter of fact, also a <a data-link-type="dfn|abstract-op" href="#dfn-unique-annotation" class="internalDFN" id="ref-for-dfn-unique-annotation-3">Unique annotation</a>.</p>
</section><section id="notnull"><div class="header-wrapper"><h3 id="x7-5-notnull"><bdi class="secno">7.5 </bdi>NotNull</h3><a class="self-link" href="#notnull" aria-label="Permalink for Section 7.5"></a></div>
<p>The <dfn data-lt="NotNull annotation|NotNull structural annotation" id="dfn-notnull-annotation" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">NotNull structural annotation</dfn> (<code>rml:NotNullAnnotation</code>) is analogous to the notion of <i>NOT NULL constraints</i> in databases. Specifically, a <a data-link-type="dfn|abstract-op" href="#dfn-notnull-annotation" class="internalDFN" id="ref-for-dfn-notnull-annotation-2">NotNull annotation</a> <a data-link-type="dfn|abstract-op" href="#dfn-on-fields" class="internalDFN" id="ref-for-dfn-on-fields-5">on fields</a>  <em>F</em>  imposes that each field in <em>F</em> does not contain NULL values.</p>
<div class="note" role="note" id="issue-container-generatedID-1"><div role="heading" class="note-title marker" id="h-note-1" aria-level="4"><span>Note</span></div><aside class="">
Note that every <a data-link-type="dfn|abstract-op" href="#dfn-primarykey-annotation" class="internalDFN" id="ref-for-dfn-primarykey-annotation-4">PrimaryKey annotation</a> is, as a matter of fact, also a <a data-link-type="dfn|abstract-op" href="#dfn-notnull-annotation" class="internalDFN" id="ref-for-dfn-notnull-annotation-3">NotNull annotation</a>.
</aside></div>

</section><section id="foreignkey"><div class="header-wrapper"><h3 id="x7-6-foreignkey"><bdi class="secno">7.6 </bdi>ForeignKey</h3><a class="self-link" href="#foreignkey" aria-label="Permalink for Section 7.6"></a></div>
<p>The <dfn data-lt="ForeignKey annotation|ForeignKey structural annotation" id="dfn-foreignkey-annotation" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">ForeignKey structural annotation</dfn> (<code>rml:ForeignKeyAnnotation</code>) is analogous to the notion of <i>foreign key constraint</i> in databases. Specifically, a <a data-link-type="dfn|abstract-op" href="#dfn-foreignkey-annotation" class="internalDFN" id="ref-for-dfn-foreignkey-annotation-2">ForeignKey annotation</a> <a data-link-type="dfn|abstract-op" href="#dfn-on-fields" class="internalDFN" id="ref-for-dfn-on-fields-6">on fields</a>  <em>(f1, ..., fn)</em> , <a data-link-type="dfn|abstract-op" href="#dfn-target-view" class="internalDFN" id="ref-for-dfn-target-view-1">target view</a> <i>lv</i>, and <a data-link-type="dfn|abstract-op" href="#dfn-target-fields" class="internalDFN" id="ref-for-dfn-target-fields-1">target fields</a> <em>(tf1,...,tfn)</em> imposes the following conditions:</p>
<ul>
<li>each NULL-free record sequence over the list of fields <em>(f1, ..., fn)</em> occurs also as a record sequence in <em>(tf1,...,tfn)</em>;</li>
<li>Target view <i>lv</i> defines a <a data-link-type="dfn|abstract-op" href="#dfn-unique-annotation" class="internalDFN" id="ref-for-dfn-unique-annotation-4">Unique annotation</a> <a data-link-type="dfn|abstract-op" href="#dfn-on-fields" class="internalDFN" id="ref-for-dfn-on-fields-7">on fields</a> <em>(tf1,...,tfn)</em>.</li>
</ul>
<p>The <dfn id="dfn-target-view" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">target view</dfn> is a <a data-link-type="dfn|abstract-op" href="#dfn-logical-view" class="internalDFN" id="ref-for-dfn-logical-view-14">logical view</a> specified through the property <code>rml:targetView</code>, whereas the <dfn id="dfn-target-fields" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">target fields</dfn> are an RDF list of field names specified through the property <code>rml:targetFields</code>. These two properties are specified as follows:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Domain</th>
<th>Range</th>
</tr>
</thead>
<tbody><tr>
<td><code>rml:targetView</code></td>
<td><code>rml:InclusionAnnotation</code></td>
<td><code>rml:LogicalView</code></td>
</tr>
<tr>
<td><code>rml:targetFields</code></td>
<td><code>rml:InclusionAnnotation</code></td>
<td><code>rdf:List</code></td>
</tr>
</tbody></table>
<p>Therefore, each ForeignKey annotation <em class="rfc2119">MUST</em> specify (additionally to the inherited <code>rml:onFields</code> property):</p>
<ul>
<li>Exactly one <code>rml:targetView</code> property</li>
<li>Exactly one <code>rml:targetFields</code> property.</li>
</ul>
<aside class="example" id="foreign-key"><div class="marker">
    <a class="self-link" href="#foreign-key">Example<bdi> 19</bdi></a>
  </div>

<p>Consider the following XML file containing information about warriors.</p>
<aside class="ex-input">

<pre><code class="json hljs" aria-busy="false"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"people"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"alice"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sword"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1500</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"shield"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2500</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bob"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"flower"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</aside>

<p>Now, assume that we know:</p>
<ul>
<li>Attribute <code>name</code> in the CSV is "UNIQUE" and "NOT NULL";</li>
<li>All warriors in our domain are contained in the CSV file.</li>
</ul>
<p>The first constraint naturally corresponds to the notion of <code>PRIMARY KEY</code> from the world of relational databases. This fact could be valuable information for the RML engine, especially in the virtual setting. However, note that constraints cannot be expressed on CSV files.</p>
<p>The second constraint naturally corresponds to a <code>FOREIGN KEY</code> constraint from the world of relational databases. However, being the involved values spread across  different (and diverse) sources, it obviously cannot be expressed as such. Also this one could provide valuable information for the RML engine.</p>
<p>We can exploit the mechanism of structural annotations to inform the RML engine about the existence of such "relational-like" constraint. We here work-out an example.</p>
<p>First, we need to specify the logical sources. The logical source corresponding to the CSV:</p>
<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:csvSource</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalSource</span> ;
  <span class="hljs-symbol">rml:source</span> <span class="hljs-symbol">:csvFile</span> ;
  <span class="hljs-symbol">rml:referenceFormulation</span> <span class="hljs-symbol">rml:CSV</span> .
</code></pre>
</aside>

<p>The logical source corresponding to the JSON:</p>
<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:jsonSource</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalSource</span> ;
  <span class="hljs-symbol">rml:source</span> <span class="hljs-symbol">:jsonFile</span> ;
  <span class="hljs-symbol">rml:referenceFormulation</span> <span class="hljs-symbol">rml:JSONPath</span> ;
  <span class="hljs-symbol">rml:iterator</span> <span class="hljs-string">"$.people[*]"</span> .
</code></pre>
</aside>

<p>We are now ready to specify our logical views, and associated structural annotations. The first logical view is the one corresponding to <code>:csvSource</code>.</p>
<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:csvSource</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalView</span> ;
  <span class="hljs-symbol">rml:viewOn</span> <span class="hljs-symbol">:csvSource</span> ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"name"</span>;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"name"</span>
 ];
 <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"birthday"</span>;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"birthday"</span>
 ];
 <span class="hljs-symbol">rml:structuralAnnotation</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:PrimaryKeyAnnotation;</span>
    <span class="hljs-symbol">rml:onFields</span> (<span class="hljs-string">"name"</span>);
 ].
</code></pre>
</aside>

<p>Now, we declare the logical view corresponding to <code>:jsonSource</code>. Note that this view contains a <code>rml:ForeignKeyAnnotation</code>:</p>
<aside class="ex-mapping">

<pre><code class="turtle hljs" aria-busy="false"><span class="hljs-symbol">:jsonView</span> <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:LogicalView</span> ;
  <span class="hljs-symbol">rml:viewOn</span> <span class="hljs-symbol">:jsonSource</span> ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"name"</span> ;
    <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"$.name"</span> ;
  ] ;
  <span class="hljs-symbol">rml:field</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:IterableField</span> ;
    <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"item"</span> ;
    <span class="hljs-symbol">rml:iterator</span> <span class="hljs-string">"$.items[*]"</span> ;
    <span class="hljs-symbol">rml:field</span> [
      <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
      <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"type"</span> ;
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"$.type"</span> ;
    ] ;
    <span class="hljs-symbol">rml:field</span> [
      <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ExpressionField</span> ;
      <span class="hljs-symbol">rml:fieldName</span> <span class="hljs-string">"weight"</span> ;
      <span class="hljs-symbol">rml:reference</span> <span class="hljs-string">"$.weight"</span> ;
    ]
  ] ;
  <span class="hljs-symbol">rml:structuralAnnotation</span> [
    <span class="hljs-built_in">a</span> <span class="hljs-symbol">rml:ForeignKeyAnnotation;</span>
    <span class="hljs-symbol">rml:onFields</span> (<span class="hljs-string">"name"</span>);
    <span class="hljs-symbol">rml:targetView</span> <span class="hljs-symbol">:csvView;</span>
    <span class="hljs-symbol">rml:targetFields</span> (<span class="hljs-string">"name"</span>)
  ].
</code></pre>
</aside>
</aside>

</section><section id="inclusion"><div class="header-wrapper"><h3 id="x7-7-inclusion"><bdi class="secno">7.7 </bdi>Inclusion</h3><a class="self-link" href="#inclusion" aria-label="Permalink for Section 7.7"></a></div>
<p>The <dfn data-lt="Inclusion annotation|Inclusion structural annotation" id="dfn-inclusion-annotation" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Inclusion structural annotation</dfn> (<code>rml:InclusionAnnotation</code>) is analogous to the notion of <i>inclusion dependency</i> in databases. Specifically, an <a data-link-type="dfn|abstract-op" href="#dfn-inclusion-annotation" class="internalDFN" id="ref-for-dfn-inclusion-annotation-2">Inclusion annotation</a> <a data-link-type="dfn|abstract-op" href="#dfn-on-fields" class="internalDFN" id="ref-for-dfn-on-fields-8">on fields</a>  <em>(f1, ..., fn)</em> , <a data-link-type="dfn|abstract-op" href="#dfn-target-view" class="internalDFN" id="ref-for-dfn-target-view-2">target view</a> <i>lv</i>, and <a data-link-type="dfn|abstract-op" href="#dfn-target-fields" class="internalDFN" id="ref-for-dfn-target-fields-2">target fields</a> <em>(tf1,...,tfn)</em> imposes the following condition:</p>
<ul>
<li>each NULL-free record sequence over the list of fields <em>(f1, ..., fn)</em> occurs also as a record sequence in <em>(tf1,...,tfn)</em>;</li>
</ul>
<p>As for <a data-link-type="dfn|abstract-op" href="#dfn-foreignkey-annotation" class="internalDFN" id="ref-for-dfn-foreignkey-annotation-3">ForeignKey annotation</a>, the <a data-link-type="dfn|abstract-op" href="#dfn-target-view" class="internalDFN" id="ref-for-dfn-target-view-3">target view</a> <em class="rfc2119">MUST</em> be a <a data-link-type="dfn|abstract-op" href="#dfn-logical-view" class="internalDFN" id="ref-for-dfn-logical-view-15">logical view</a> specified through the property <code>rml:targetView</code>, whereas the <def>target fields</def> <em class="rfc2119">MUST</em> be an RDF list of field names specified through the property <code>rml:targetFields</code>.</p>
<p>Therefore, each inclusion annotation <em class="rfc2119">MUST</em> specify (additionally to the inherited <code>rml:onFields</code> property):</p>
<ul>
<li>Exactly one <code>rml:targetView</code> property</li>
<li>Exactly one <code>rml:targetFields</code> property.</li>
</ul>
<div class="note" role="note" id="issue-container-generatedID-2"><div role="heading" class="note-title marker" id="h-note-2" aria-level="4"><span>Note</span></div><aside class="">
Note that every <a data-link-type="dfn|abstract-op" href="#dfn-foreignkey-annotation" class="internalDFN" id="ref-for-dfn-foreignkey-annotation-4">ForeignKey annotation</a> is also an <a data-link-type="dfn|abstract-op" href="#dfn-inclusion-annotation" class="internalDFN" id="ref-for-dfn-inclusion-annotation-3">Inclusion annotation</a>.
</aside></div></section></section>



<section id="references" class="appendix"><div class="header-wrapper"><h2 id="a-references"><bdi class="secno">A. </bdi>References</h2><a class="self-link" href="#references" aria-label="Permalink for Appendix A."></a></div><section id="normative-references"><div class="header-wrapper"><h3 id="a-1-normative-references"><bdi class="secno">A.1 </bdi>Normative references</h3><a class="self-link" href="#normative-references" aria-label="Permalink for Appendix A.1"></a></div>
    
    <dl class="bibliography"><dt id="bib-rfc2119">[RFC2119]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
    </dd><dt id="bib-rfc8174">[RFC8174]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.  IETF. May 2017. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
    </dd><dt id="bib-rml-core">[RML-Core]</dt><dd>
      <a href="https://w3id.org/rml/core/spec"><cite>RML-Core</cite></a>.  W3C. 16 February 2024. Draft Community Group Report. URL: <a href="https://w3id.org/rml/core/spec">https://w3id.org/rml/core/spec</a>
    </dd><dt id="bib-turtle">[Turtle]</dt><dd>
      <a href="https://www.w3.org/TR/turtle/"><cite>RDF 1.1 Turtle</cite></a>. Eric Prud'hommeaux; Gavin Carothers.  W3C. 25 February 2014. W3C Recommendation. URL: <a href="https://www.w3.org/TR/turtle/">https://www.w3.org/TR/turtle/</a>
    </dd></dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-record" aria-label="Links in this document to definition: record">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-record" aria-label="Permalink for definition: record. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-record-1" title="§ 3. Records">§ 3. Records</a> <a href="#ref-for-dfn-record-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-record-3" title="Reference 3">(3)</a> <a href="#ref-for-dfn-record-4" title="Reference 4">(4)</a> <a href="#ref-for-dfn-record-5" title="Reference 5">(5)</a> <a href="#ref-for-dfn-record-6" title="Reference 6">(6)</a> <a href="#ref-for-dfn-record-7" title="Reference 7">(7)</a> <a href="#ref-for-dfn-record-8" title="Reference 8">(8)</a> <a href="#ref-for-dfn-record-9" title="Reference 9">(9)</a> <a href="#ref-for-dfn-record-10" title="Reference 10">(10)</a> <a href="#ref-for-dfn-record-11" title="Reference 11">(11)</a> <a href="#ref-for-dfn-record-12" title="Reference 12">(12)</a> <a href="#ref-for-dfn-record-13" title="Reference 13">(13)</a> 
    </li><li>
      <a href="#ref-for-dfn-record-14" title="§ 3.2 Record sequences">§ 3.2 Record sequences</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-expression-values" aria-label="Links in this document to definition: expression values">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-expression-values" aria-label="Permalink for definition: expression values. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-record-sequence" aria-label="Links in this document to definition: record sequence">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-record-sequence" aria-label="Permalink for definition: record sequence. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-record-sequence-1" title="§ 3.2 Record sequences">§ 3.2 Record sequences</a> 
    </li><li>
      <a href="#ref-for-dfn-record-sequence-2" title="§ 5.3 Field record sequences and records">§ 5.3 Field record sequences and records</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-iterator-record-sequence" aria-label="Links in this document to definition: iterator record sequence">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-iterator-record-sequence" aria-label="Permalink for definition: iterator record sequence. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-logical-view" aria-label="Links in this document to definition: logical view">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-logical-view" aria-label="Permalink for definition: logical view. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-logical-view-1" title="§ 4. Logical views">§ 4. Logical views</a> <a href="#ref-for-dfn-logical-view-2" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-logical-view-3" title="§ 5. Fields">§ 5. Fields</a> 
    </li><li>
      <a href="#ref-for-dfn-logical-view-4" title="§ 5.1 Field parents">§ 5.1 Field parents</a> 
    </li><li>
      <a href="#ref-for-dfn-logical-view-5" title="§ 5.2 Field names">§ 5.2 Field names</a> 
    </li><li>
      <a href="#ref-for-dfn-logical-view-6" title="§ 5.3 Field record sequences and records">§ 5.3 Field record sequences and records</a> 
    </li><li>
      <a href="#ref-for-dfn-logical-view-7" title="§ 5.4 Field reference formulations">§ 5.4 Field reference formulations</a> 
    </li><li>
      <a href="#ref-for-dfn-logical-view-8" title="§ 6. Logical view joins">§ 6. Logical view joins</a> <a href="#ref-for-dfn-logical-view-9" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-logical-view-10" title="§ 6.2.1 Left join">§ 6.2.1 Left join</a> 
    </li><li>
      <a href="#ref-for-dfn-logical-view-11" title="§ 6.2.3 Two left joins">§ 6.2.3 Two left joins</a> 
    </li><li>
      <a href="#ref-for-dfn-logical-view-12" title="§ 7. Structural Annotations">§ 7. Structural Annotations</a> 
    </li><li>
      <a href="#ref-for-dfn-logical-view-13" title="§ 7.3 PrimaryKey">§ 7.3 PrimaryKey</a> 
    </li><li>
      <a href="#ref-for-dfn-logical-view-14" title="§ 7.6 ForeignKey">§ 7.6 ForeignKey</a> 
    </li><li>
      <a href="#ref-for-dfn-logical-view-15" title="§ 7.7 Inclusion">§ 7.7 Inclusion</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-field" aria-label="Links in this document to definition: field">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-field" aria-label="Permalink for definition: field. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-field-1" title="§ 4. Logical views">§ 4. Logical views</a> <a href="#ref-for-dfn-field-2" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-field-3" title="§ 5. Fields">§ 5. Fields</a> <a href="#ref-for-dfn-field-4" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-field-5" title="§ 5.1 Field parents">§ 5.1 Field parents</a> <a href="#ref-for-dfn-field-6" title="Reference 2">(2)</a> <a href="#ref-for-dfn-field-7" title="Reference 3">(3)</a> <a href="#ref-for-dfn-field-8" title="Reference 4">(4)</a> <a href="#ref-for-dfn-field-9" title="Reference 5">(5)</a> <a href="#ref-for-dfn-field-10" title="Reference 6">(6)</a> 
    </li><li>
      <a href="#ref-for-dfn-field-11" title="§ 5.2 Field names">§ 5.2 Field names</a> <a href="#ref-for-dfn-field-12" title="Reference 2">(2)</a> <a href="#ref-for-dfn-field-13" title="Reference 3">(3)</a> <a href="#ref-for-dfn-field-14" title="Reference 4">(4)</a> <a href="#ref-for-dfn-field-15" title="Reference 5">(5)</a> <a href="#ref-for-dfn-field-16" title="Reference 6">(6)</a> <a href="#ref-for-dfn-field-17" title="Reference 7">(7)</a> <a href="#ref-for-dfn-field-18" title="Reference 8">(8)</a> <a href="#ref-for-dfn-field-19" title="Reference 9">(9)</a> 
    </li><li>
      <a href="#ref-for-dfn-field-20" title="§ 5.3 Field record sequences and records">§ 5.3 Field record sequences and records</a> <a href="#ref-for-dfn-field-21" title="Reference 2">(2)</a> <a href="#ref-for-dfn-field-22" title="Reference 3">(3)</a> <a href="#ref-for-dfn-field-23" title="Reference 4">(4)</a> <a href="#ref-for-dfn-field-24" title="Reference 5">(5)</a> <a href="#ref-for-dfn-field-25" title="Reference 6">(6)</a> <a href="#ref-for-dfn-field-26" title="Reference 7">(7)</a> <a href="#ref-for-dfn-field-27" title="Reference 8">(8)</a> 
    </li><li>
      <a href="#ref-for-dfn-field-28" title="§ 5.4 Field reference formulations">§ 5.4 Field reference formulations</a> <a href="#ref-for-dfn-field-29" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-field-30" title="§ 5.5 Using field names in triples maps">§ 5.5 Using field names in triples maps</a> <a href="#ref-for-dfn-field-31" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-expression-field" aria-label="Links in this document to definition: expression field">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-expression-field" aria-label="Permalink for definition: expression field. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-expression-field-1" title="§ 5. Fields">§ 5. Fields</a> <a href="#ref-for-dfn-expression-field-2" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-expression-field-3" title="§ 5.3 Field record sequences and records">§ 5.3 Field record sequences and records</a> 
    </li><li>
      <a href="#ref-for-dfn-expression-field-4" title="§ 5.4 Field reference formulations">§ 5.4 Field reference formulations</a> <a href="#ref-for-dfn-expression-field-5" title="Reference 2">(2)</a> <a href="#ref-for-dfn-expression-field-6" title="Reference 3">(3)</a> <a href="#ref-for-dfn-expression-field-7" title="Reference 4">(4)</a> 
    </li><li>
      <a href="#ref-for-dfn-expression-field-8" title="§ 5.5 Using field names in triples maps">§ 5.5 Using field names in triples maps</a> 
    </li><li>
      <a href="#ref-for-dfn-expression-field-9" title="§ 6. Logical view joins">§ 6. Logical view joins</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-iterable-field" aria-label="Links in this document to definition: iterable field">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-iterable-field" aria-label="Permalink for definition: iterable field. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-iterable-field-1" title="§ 5. Fields">§ 5. Fields</a> <a href="#ref-for-dfn-iterable-field-2" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-iterable-field-3" title="§ 5.3 Field record sequences and records">§ 5.3 Field record sequences and records</a> 
    </li><li>
      <a href="#ref-for-dfn-iterable-field-4" title="§ 5.4 Field reference formulations">§ 5.4 Field reference formulations</a> <a href="#ref-for-dfn-iterable-field-5" title="Reference 2">(2)</a> <a href="#ref-for-dfn-iterable-field-6" title="Reference 3">(3)</a> <a href="#ref-for-dfn-iterable-field-7" title="Reference 4">(4)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-parent" aria-label="Links in this document to definition: parent">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-parent" aria-label="Permalink for definition: parent. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-parent-1" title="§ 5. Fields">§ 5. Fields</a> 
    </li><li>
      <a href="#ref-for-dfn-parent-2" title="§ 5.2 Field names">§ 5.2 Field names</a> 
    </li><li>
      <a href="#ref-for-dfn-parent-3" title="§ 5.3 Field record sequences and records">§ 5.3 Field record sequences and records</a> 
    </li><li>
      <a href="#ref-for-dfn-parent-4" title="§ 5.4 Field reference formulations">§ 5.4 Field reference formulations</a> <a href="#ref-for-dfn-parent-5" title="Reference 2">(2)</a> <a href="#ref-for-dfn-parent-6" title="Reference 3">(3)</a> <a href="#ref-for-dfn-parent-7" title="Reference 4">(4)</a> <a href="#ref-for-dfn-parent-8" title="Reference 5">(5)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-ancestors" aria-label="Links in this document to definition: ancestors">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-ancestors" aria-label="Permalink for definition: ancestors. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-declared-name" aria-label="Links in this document to definition: declared name">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-declared-name" aria-label="Permalink for definition: declared name. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-declared-name-1" title="§ 5.2 Field names">§ 5.2 Field names</a> <a href="#ref-for-dfn-declared-name-2" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-declared-name-3" title="§ 5.3 Field record sequences and records">§ 5.3 Field record sequences and records</a> 
    </li><li>
      <a href="#ref-for-dfn-declared-name-4" title="§ 5.4 Field reference formulations">§ 5.4 Field reference formulations</a> <a href="#ref-for-dfn-declared-name-5" title="Reference 2">(2)</a> <a href="#ref-for-dfn-declared-name-6" title="Reference 3">(3)</a> <a href="#ref-for-dfn-declared-name-7" title="Reference 4">(4)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-field-name" aria-label="Links in this document to definition: name">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-field-name" aria-label="Permalink for definition: name. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-field-name-1" title="§ 5. Fields">§ 5. Fields</a> 
    </li><li>
      <a href="#ref-for-dfn-field-name-2" title="§ 5.5 Using field names in triples maps">§ 5.5 Using field names in triples maps</a> <a href="#ref-for-dfn-field-name-3" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-field-record-sequence" aria-label="Links in this document to definition: field record sequence">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-field-record-sequence" aria-label="Permalink for definition: field record sequence. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-field-record-sequence-1" title="§ 5.2 Field names">§ 5.2 Field names</a> 
    </li><li>
      <a href="#ref-for-dfn-field-record-sequence-2" title="§ 5.3 Field record sequences and records">§ 5.3 Field record sequences and records</a> <a href="#ref-for-dfn-field-record-sequence-3" title="Reference 2">(2)</a> <a href="#ref-for-dfn-field-record-sequence-4" title="Reference 3">(3)</a> 
    </li><li>
      <a href="#ref-for-dfn-field-record-sequence-5" title="§ 5.5 Using field names in triples maps">§ 5.5 Using field names in triples maps</a> <a href="#ref-for-dfn-field-record-sequence-6" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-parent-records" aria-label="Links in this document to definition: parent records">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-parent-records" aria-label="Permalink for definition: parent records. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-parent-records-1" title="§ 5.3 Field record sequences and records">§ 5.3 Field record sequences and records</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-field-reference" aria-label="Links in this document to definition: field reference">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-field-reference" aria-label="Permalink for definition: field reference. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-field-reference-1" title="§ 5.5 Using field names in triples maps">§ 5.5 Using field names in triples maps</a> <a href="#ref-for-dfn-field-reference-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-field-reference-3" title="Reference 3">(3)</a> 
    </li><li>
      <a href="#ref-for-dfn-field-reference-4" title="§ 6. Logical view joins">§ 6. Logical view joins</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-logical-view-join" aria-label="Links in this document to definition: logical view join">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-logical-view-join" aria-label="Permalink for definition: logical view join. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-logical-view-join-1" title="§ 4. Logical views">§ 4. Logical views</a> 
    </li><li>
      <a href="#ref-for-dfn-logical-view-join-2" title="§ 6. Logical view joins">§ 6. Logical view joins</a> <a href="#ref-for-dfn-logical-view-join-3" title="Reference 2">(2)</a> <a href="#ref-for-dfn-logical-view-join-4" title="Reference 3">(3)</a> 
    </li><li>
      <a href="#ref-for-dfn-logical-view-join-5" title="§ 6.1 Join types">§ 6.1 Join types</a> <a href="#ref-for-dfn-logical-view-join-6" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-logical-view-join-7" title="§ 6.2.3 Two left joins">§ 6.2.3 Two left joins</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-parent-logical-view" aria-label="Links in this document to definition: parent logical view">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-parent-logical-view" aria-label="Permalink for definition: parent logical view. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-parent-logical-view-1" title="§ 6. Logical view joins">§ 6. Logical view joins</a> 
    </li><li>
      <a href="#ref-for-dfn-parent-logical-view-2" title="§ 6.1 Join types">§ 6.1 Join types</a> 
    </li><li>
      <a href="#ref-for-dfn-parent-logical-view-3" title="§ 6.2.3 Two left joins">§ 6.2.3 Two left joins</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-child-logical-view" aria-label="Links in this document to definition: child logical view">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-child-logical-view" aria-label="Permalink for definition: child logical view. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-child-logical-view-1" title="§ 6. Logical view joins">§ 6. Logical view joins</a> 
    </li><li>
      <a href="#ref-for-dfn-child-logical-view-2" title="§ 6.1 Join types">§ 6.1 Join types</a> <a href="#ref-for-dfn-child-logical-view-3" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-join-property" aria-label="Links in this document to definition: join property">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-join-property" aria-label="Permalink for definition: join property. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-join-property-1" title="§ 6. Logical view joins">§ 6. Logical view joins</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-left-join" aria-label="Links in this document to definition: left join">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-left-join" aria-label="Permalink for definition: left join. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-left-join-1" title="§ 6.1 Join types">§ 6.1 Join types</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-inner-join" aria-label="Links in this document to definition: inner join">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-inner-join" aria-label="Permalink for definition: inner join. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-inner-join-1" title="§ 6.1 Join types">§ 6.1 Join types</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-structural-annotations" aria-label="Links in this document to definition: Structural annotations">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-structural-annotations" aria-label="Permalink for definition: Structural annotations. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-structural-annotations-1" title="§ 7. Structural Annotations">§ 7. Structural Annotations</a> <a href="#ref-for-dfn-structural-annotations-2" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-on-fields" aria-label="Links in this document to definition: on fields">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-on-fields" aria-label="Permalink for definition: on fields. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-on-fields-1" title="§ 7. Structural Annotations">§ 7. Structural Annotations</a> 
    </li><li>
      <a href="#ref-for-dfn-on-fields-2" title="§ 7.2 IriSafe">§ 7.2 IriSafe</a> 
    </li><li>
      <a href="#ref-for-dfn-on-fields-3" title="§ 7.3 PrimaryKey">§ 7.3 PrimaryKey</a> 
    </li><li>
      <a href="#ref-for-dfn-on-fields-4" title="§ 7.4 Unique">§ 7.4 Unique</a> 
    </li><li>
      <a href="#ref-for-dfn-on-fields-5" title="§ 7.5 NotNull">§ 7.5 NotNull</a> 
    </li><li>
      <a href="#ref-for-dfn-on-fields-6" title="§ 7.6 ForeignKey">§ 7.6 ForeignKey</a> <a href="#ref-for-dfn-on-fields-7" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-on-fields-8" title="§ 7.7 Inclusion">§ 7.7 Inclusion</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-irisafe-annotation" aria-label="Links in this document to definition: IriSafe structural annotation">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-irisafe-annotation" aria-label="Permalink for definition: IriSafe structural annotation. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-irisafe-annotation-1" title="§ 7. Structural Annotations">§ 7. Structural Annotations</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-primarykey-annotation" aria-label="Links in this document to definition: PrimaryKey structural annotation">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-primarykey-annotation" aria-label="Permalink for definition: PrimaryKey structural annotation. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-primarykey-annotation-1" title="§ 7. Structural Annotations">§ 7. Structural Annotations</a> 
    </li><li>
      <a href="#ref-for-dfn-primarykey-annotation-2" title="§ 7.3 PrimaryKey">§ 7.3 PrimaryKey</a> 
    </li><li>
      <a href="#ref-for-dfn-primarykey-annotation-3" title="§ 7.4 Unique">§ 7.4 Unique</a> 
    </li><li>
      <a href="#ref-for-dfn-primarykey-annotation-4" title="§ 7.5 NotNull">§ 7.5 NotNull</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-unique-annotation" aria-label="Links in this document to definition: Unique structural annotation">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-unique-annotation" aria-label="Permalink for definition: Unique structural annotation. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-unique-annotation-1" title="§ 7. Structural Annotations">§ 7. Structural Annotations</a> 
    </li><li>
      <a href="#ref-for-dfn-unique-annotation-2" title="§ 7.4 Unique">§ 7.4 Unique</a> <a href="#ref-for-dfn-unique-annotation-3" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-unique-annotation-4" title="§ 7.6 ForeignKey">§ 7.6 ForeignKey</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-notnull-annotation" aria-label="Links in this document to definition: NotNull structural annotation">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-notnull-annotation" aria-label="Permalink for definition: NotNull structural annotation. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-notnull-annotation-1" title="§ 7. Structural Annotations">§ 7. Structural Annotations</a> 
    </li><li>
      <a href="#ref-for-dfn-notnull-annotation-2" title="§ 7.5 NotNull">§ 7.5 NotNull</a> <a href="#ref-for-dfn-notnull-annotation-3" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-foreignkey-annotation" aria-label="Links in this document to definition: ForeignKey structural annotation">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-foreignkey-annotation" aria-label="Permalink for definition: ForeignKey structural annotation. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-foreignkey-annotation-1" title="§ 7. Structural Annotations">§ 7. Structural Annotations</a> 
    </li><li>
      <a href="#ref-for-dfn-foreignkey-annotation-2" title="§ 7.6 ForeignKey">§ 7.6 ForeignKey</a> 
    </li><li>
      <a href="#ref-for-dfn-foreignkey-annotation-3" title="§ 7.7 Inclusion">§ 7.7 Inclusion</a> <a href="#ref-for-dfn-foreignkey-annotation-4" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-target-view" aria-label="Links in this document to definition: target view">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-target-view" aria-label="Permalink for definition: target view. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-target-view-1" title="§ 7.6 ForeignKey">§ 7.6 ForeignKey</a> 
    </li><li>
      <a href="#ref-for-dfn-target-view-2" title="§ 7.7 Inclusion">§ 7.7 Inclusion</a> <a href="#ref-for-dfn-target-view-3" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-target-fields" aria-label="Links in this document to definition: target fields">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-target-fields" aria-label="Permalink for definition: target fields. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-target-fields-1" title="§ 7.6 ForeignKey">§ 7.6 ForeignKey</a> 
    </li><li>
      <a href="#ref-for-dfn-target-fields-2" title="§ 7.7 Inclusion">§ 7.7 Inclusion</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-inclusion-annotation" aria-label="Links in this document to definition: Inclusion structural annotation">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-inclusion-annotation" aria-label="Permalink for definition: Inclusion structural annotation. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-inclusion-annotation-1" title="§ 7. Structural Annotations">§ 7. Structural Annotations</a> 
    </li><li>
      <a href="#ref-for-dfn-inclusion-annotation-2" title="§ 7.7 Inclusion">§ 7.7 Inclusion</a> <a href="#ref-for-dfn-inclusion-annotation-3" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>